const express = require('express');
const path = require('path');
const sqlite3 = require('sqlite3').verbose();
const bcrypt = require('bcryptjs');
const app = express();
const port = 5000;

// 解析 JSON 格式的請求體
app.use(express.json());

// 提供靜態檔案
app.use(express.static(path.join(__dirname)));

// 初始化 SQLite 資料庫
const db = new sqlite3.Database('./database.db', (err) => {
    if (err) {
        console.error('資料庫連線錯誤:', err.message);
    } else {
        console.log('成功連線到 SQLite 資料庫');
        // 建立 users 表
        db.run(`CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            username TEXT UNIQUE NOT NULL,
            password TEXT NOT NULL
        )`, (err) => {
            if (err) {
                console.error('建立使用者表格錯誤:', err.message);
            } else {
                console.log('使用者表格已準備好');
            }
        });
        // 建立系統參數資料表
        db.run(`CREATE TABLE IF NOT EXISTS sys_parainfo (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            param_code VARCHAR(50) NOT NULL,
            param_value VARCHAR(255) NOT NULL,
            param_desc VARCHAR(255),
            sys_flag CHAR(1) NOT NULL DEFAULT 'N'
        )`, (err) => {
            if (err) {
                console.error('建立系統參數表格錯誤:', err.message);
            } else {
                console.log('系統參數表格已準備好');
            }
        });
        // 建立系統功能資料表
        db.run(`CREATE TABLE IF NOT EXISTS sys_menuinfo (
            menuid INTEGER PRIMARY KEY AUTOINCREMENT,
            paretid INTEGER DEFAULT 0,
            menuna NVARCHAR(255) NOT NULL,
            menuimg VARCHAR(255) DEFAULT '',
            menuurl VARCHAR(255) DEFAULT '',
            menonly CHAR(1) DEFAULT 'Y',
            opennew CHAR(1) DEFAULT 'N',
            dispseq CHAR(10) DEFAULT '00100',
            lastusr INTEGER DEFAULT 0,
            lasttm CHAR(14) DEFAULT ''
        )`, (err) => {
            if (err) {
                console.error('建立系統功能表格錯誤:', err.message);
            } else {
                console.log('系統功能表格已準備好');
                // 檢查並新增測驗選單
                db.get('SELECT * FROM sys_menuinfo WHERE menuurl = ?', ['/quiz'], (err, row) => {
                    if (!err && !row) {
                        db.run(`INSERT INTO sys_menuinfo (menuna, menuurl, dispseq) VALUES (?, ?, ?)`,
                            ['線上測驗', '/quiz', '00200'],
                            (err) => {
                                if (err) {
                                    console.error('插入測驗選單項目錯誤:', err.message);
                                } else {
                                    console.log('已新增線上測驗至選單');
                                }
                            }
                        );
                    }
                });
            }
        });
        // 建立測驗資料表（保留）
        db.run(`CREATE TABLE IF NOT EXISTS quizzes (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            subject TEXT NOT NULL,
            question TEXT NOT NULL,
            option_a TEXT NOT NULL,
            option_b TEXT NOT NULL,
            option_c TEXT NOT NULL,
            option_d TEXT NOT NULL,
            correct_answer CHAR(1) NOT NULL
        )`, (err) => {
            if (err) {
                console.error('建立測驗表格錯誤:', err.message);
            } else {
                console.log('測驗表格已準備好');
                // 插入或更新測驗題目
                seedQuizData();
            }
        });
    }
});

// 插入或更新測驗題目的函式
function seedQuizData() {
    db.serialize(() => {
        // --- 基礎醫學 ---
        const subjectBM = '基礎醫學';
        const quizzesBM = [
            { q: '心肌的肌內質網主要受何者刺激而釋放鈣離子？', o: ['細胞外流入的鈉離子', '肌醇三磷酸', '細胞外流入的鈣離子', '細胞膜電位的改變'], a: 'C' },
            { q: '下列何種疾病與耳朵功能異常最無關？', o: ["黃斑退化症（ macular degeneration）", "梅尼爾氏症（ Meniere's disease）", "良性陣發性姿勢型暈眩（ benign paroxysmal positional vertigo）", "動暈症（ motion sickness）"], a: 'A' },
            { q: '下列何者會導致電位過極化（ hyperpolarizing）， 進而誘發抑制性突觸後電位（ inhibitory postsynaptic potential, IPSP） 的表現？', o: ['Cl– channel open； K＋ channel open', 'Na＋ channel open； K＋ channel open', 'Ca２＋ channel open； K＋ channel open', 'Na＋ channel open； Cl– channel open'], a: 'A' },
            { q: '下列有關褪黑激素（ melatonin） 的敘述， 何者錯誤？', o: ['可由松果腺（ pineal gland） 分泌', '血清素（ serotonin） 為其前驅物', '夜晚睡眠時體內之濃度最低', '可治療時差所造成的不適'], a: 'C' },
            { q: '在人類胚胎期， 下列何種激素最可能直接刺激外生殖構造發育為男性？', o: ['睪固酮（ testosterone）', '雙氫睪固酮（ DHT）', '雌激素（ estrogen）', '去氫雄脂酮（ DHEA）'], a: 'B' },
            { q: '特定微血管區段之微血管靜水壓（ capillary hydrostatic pressure） 為24 mmHg、組織間隙靜水壓（ interstitial hydrostatic pressure） 為0 mmHg、微血管滲透壓（ capillary colloid osmotic pressure） 為12 mmHg、組織間隙滲透壓（ interstitial colloid osmotic pressure） 為2 mmHg，則該處微血管液流動形式及總驅動力（ net filtration pressure） 分別為何？', o: ['再吸收（ absorption） 流入微血管： 7 mmHg', '再吸收（ absorption） 流入微血管： 14 mmHg', '過濾（ filtration） 流出微血管： 7 mmHg', '過濾（ filtration） 流出微血管： 14 mmHg'], a: 'D' },
            { q: '在胎兒時期， 下列那個構造可與右心房直接相通？', o: ['動脈導管', '肺動脈幹', '左心房', '左心室'], a: 'C' },
            { q: '正常情況下， 下列何種物質在腎臟再吸收（ reabsorption） 的比例最高？', o: ['水', '鈉離子', '葡萄糖', '尿素'], a: 'C' },
            { q: '肺氣腫（ emphysema） 患者因肺泡壁遭到破壞而容易出現下列那一種變化？', o: ['肺泡氣體擴散的總面積增加', '肺臟回彈力增加', '肺臟順應性增加', '呼吸道阻力降低'], a: 'C' },
            { q: '有關輔脂解酶（ colipase） 的敘述， 下列何者正確？', o: ['由胰臟分泌', '由肝臟分泌', '僅具脂溶性', '具脂解的作用'], a: 'A' },
            { q: '下列那兩個體內空腔之間沒有實質構造區隔， 其中一個空腔內如果產生積水， 會在兩個空腔內互相流通？', o: ['縱膈腔（ mediastinum） 與胸膜腔（ pleural cavity）', '胸膜腔（ pleural cavity） 與心包腔（ pericardial cavity）', '心包腔（ pericardial cavity） 與腹腔（ abdominal cavity）', '腹腔（ abdominal cavity） 與骨盆腔（ pelvic cavity）'], a: 'D' },
            { q: '關於腦下垂體（ pituitary gland） 的描述， 下列何者錯誤？', o: ['與下視丘（ hypothalamus） 相連', '位於蝶鞍的腦下垂體窩', '腦下垂體中間部分泌黑色素細胞刺激素（ melanocyte-stimulating hormone）', '腦下垂體中間部分泌褪黑素（ melatonin）'], a: 'D' },
            { q: '下列有關成人腰椎（ lumbar vertebrae） 的敘述， 何者正確？', o: ['典型腰椎棘突（ spinous process） 細長， 朝下延伸', '典型腰椎橫突（ transverse process） 具孔洞， 供神經穿行', '腰椎曲（ lumbar curvature） 是往前拱起的彎曲', '腰椎穿刺（ lumbar puncture） 一般是在第一、二腰椎之間進行'], a: 'C' },
            { q: '下列何者屬於彈性動脈？', o: ['腎動脈（ renal artery）', '脾動脈（ splenic artery）', '股動脈（ femoral artery）', '主動脈（ aorta）'], a: 'D' },
            { q: '下列何者不是輸尿管（ ureter） 管腔較為狹窄的位置？', o: ['腎盂（ renal pelvis） 與輸尿管交接處', '腰大肌（ psoas major） 表面', '髂總動脈（ common iliac artery） 分叉為髂內及髂外動脈處', '穿進膀胱（ urinary bladder） 處'], a: 'B' },
            { q: '下列何者不具支撐子宮（ uterus） 的功能？', o: ['主韌帶（ cardinal ligament）', '懸韌帶（ suspensory ligament）', '骨盆膈（ pelvic diaphragm）', '泌尿生殖膈（ urogenital diaphragm）'], a: 'B' },
            { q: '下列何者為負責分泌胃酸的細胞？', o: ['主細胞（ chief cell）', '壁細胞（ parietal cell）', '黏液頸細胞（ mucous neck cell）', '腸內分泌細胞（ enteroendocrine cell）'], a: 'B' },
            { q: '耳下腺導管（ parotid duct） 開口於口腔何處的黏膜？', o: ['上列第一臼齒', '上列第二臼齒', '上列第三臼齒', '下列第二臼齒'], a: 'B' },
            { q: '當肱骨（ humerus） 的骨幹發生骨折， 最可能直接傷及那一條手臂的神經？', o: ['肌皮神經（ musculocutaneous nerve）', '正中神經（ median nerve）', '尺神經（ ulnar nerve）', '橈神經（ radial nerve）'], a: 'D' },
            { q: '下列何者源自骨髓細胞， 而後遷移至中樞神經系統內成熟？', o: ['星狀細胞（ astrocytes）', '寡樹突膠細胞（ oligodendrocytes）', '微膠細胞（ microglia）', '室管膜細胞（ ependymal cells）'], a: 'C' },
            { q: '有關急性發炎反應（ acute inflammation） 的敘述， 下列何者正確？', o: ['參與的白血球主要是嗜酸性白血球（ eosinophils）', '組織間隙常因血管通透性增加所以有漏出液（ transudate） 的蓄積', '受損組織細胞分泌的緩激肽（ bradykinin） 與痛 產生有關', '介白素-1（ interleukin-1） 是造成血管舒張主要的媒介物'], a: 'C' },
            { q: '下列何者與血液的高凝血狀態易形成血栓的關聯性最小？', o: ['長期臥床', '口服避孕藥之使用', '抗磷脂質症候群', 'von Willebrand疾病'], a: 'D' },
            { q: 'KIT基因突變是下列那種腫瘤最常見的分子變化？', o: ['肺腺癌', '胃腸道基質瘤', '肝癌', '膀胱癌'], a: 'B' },
            { q: '下列何者並非鉛中毒的常見表現？', o: ['肝硬化', '兒童智力發展障礙', '周邊神經病變', '貧血'], a: 'A' },
            { q: '下列何種血管炎會造成主動脈（ aorta） 及其主要分支的發炎狹窄， 可能導致上肢摸不到脈搏， 因而又稱為無脈症（ pulseless disease）？', o: ["高安氏動脈炎（ Takayasu arteritis）", "川崎氏病（ Kawasaki disease）", "韋格納氏肉芽腫（ Wegener granulomatosis）", "伯格氏病（ Buerger disease）"], a: 'A' },
            { q: '下列何者是何杰金氏淋巴瘤（ Hodgkin lymphoma） 的腫瘤細胞？', o: ['淋巴母細胞（ lymphoblast）', '副免疫母細胞（ paraimmunoblast）', '瑞德－ 史登堡氏細胞（ Reed-Sternberg cell）', '卡哈爾－ 瑞齊烏斯氏細胞（ Cajal-Retzius cell）'], a: 'C' },
            { q: '有關家族性腺瘤性息肉症（ familial adenomatous polyposis）， 下列敘述何者錯誤？', o: ['是體染色體隱性（ autosomal recessive） 遺傳', '病人的大腸會有超過100個腺瘤性息肉', '未治療的病人幾乎都會發生大腸癌', '可以用預防性大腸切除術來治療'], a: 'A' },
            { q: '下列何者為快速進行性腎絲球腎炎（ rapidly progressive glomerulonephritis） 最主要的病理變化？', o: ['新月體（ crescent）', '乾酪性壞死（ caseous necrosis）', '羅素小體（ Russell body）', '類纖維素性壞死（ fibrinoid necrosis）'], a: 'A' },
            { q: '乳癌病患出現橘皮（ peau d\'orange） 現象， 與下列何者最有關？', o: ["不典型乳管增生（ atypical ductal hyperplasia）", "發炎性癌 （ inflammatory carcinoma）", "BRCA1基因突變", "乳管擴張"], a: 'B' },
            { q: '庫賈氏病（ Creutzfeldt-Jakob disease） 最典型的病理變化為下列何者？', o: ['脫髓鞘斑塊', '腦膿瘍', '中腦黑質退化', '大腦海綿狀轉化'], a: 'D' },
            { q: '下列何種藥物不能抑制乙醯膽鹼酯酶（ acetylcholinesterase）？', o: ['physostigmine', 'sarin', 'edrophonium', 'bethanechol'], a: 'D' },
            { q: '下列藥物中， 何者對於改善酒精成癮治療沒有幫助？', o: ['naltrexone', 'acamprosate', 'acetaminophen', 'disulfiram'], a: 'C' },
            { q: '使用局部麻醉劑時常與腎上腺素合用， 其目的為何？', o: ['使局部血管收縮', '增加局部麻醉劑的吸收', '增強中樞正腎上腺素系統之止痛作用', '減少局部過敏'], a: 'A' },
            { q: '下列何種藥物可調節血清素（ serotonin） 神經傳遞系統， 達到抗憂鬱效果？', o: ['ergonovine', 'fluoxetine', 'ondansetron', 'sumatriptan'], a: 'B' },
            { q: '毛地黃中毒時， 因心跳過慢導致心律不整， 下列何者為正確且安全的治療策略?', o: ['直接給與高劑量鎂與毛地黃競爭Na+-K+ pump 的結合位', '血鉀過低時宜補充鉀， 並以atropine治療房室阻斷', '可以抗心律不整藥物amiodarone來治療', '不宜給與毛地黃抗體， 以免加重傳導阻斷'], a: 'B' },
            { q: 'Abciximab治療不穩定型心絞痛（ unstable angina） 的藥理機制為何？', o: ['cyclic nucleotide phosphodiesterase抑制劑', 'GP IIb/IIIa 抑制劑', 'cyclooxygenase I 抑制劑', 'P2Y12 ADP receptor 拮抗劑'], a: 'B' },
            { q: '下列何種藥物最適合以吸入方式用於緩解急性氣喘（ asthma） 發作？', o: ['albuterol', 'salmeterol', 'beclomethasone', 'mometasone'], a: 'A' },
            { q: '下列那一個藥物最適合用來治療變形性骨炎（ Paget disease）？', o: ['zoledronic acid', 'denosumab', 'teriparatide', 'romosozumab'], a: 'A' },
            { q: '下列有關doxorubicin的描述， 何者錯誤？', o: ['可治療急性淋巴球性白血病', '可治療肉瘤', '具有劑量依賴性的心臟毒性', '可抑制topoisomerase I 活性'], a: 'D' },
            { q: '使用化學治療藥於癌症病患， 有時會給與amifostine， 試問amifostine有何藥理作用？', o: ['保護正常細胞組織， 避免細胞損傷', '增強抗癌藥穿透血腦障壁， 進入中樞神經系統', '減少腫瘤組織周邊血液的asparagine含量', '增強病人的免疫系統功能'], a: 'A' },
            { q: '細菌間遺傳物質移轉有不同方式， 其中噬菌體（ phage） 是藉由下列何種方式進行？', o: ['接合作用（ conjugation）', '轉化作用（ transformation）', '導入作用（ transduction）', '分泌作用（ secretion）'], a: 'C' },
            { q: '有關嗜中性白血球的敘述， 下列何者錯誤？', o: ['屬於後天性免疫細胞', '產生氧化活性物質能殺死病菌', '具有吞噬微生物的能力', '可藉由特殊的死亡方式釋放網狀結構捕捉微生物'], a: 'A' },
            { q: '下列何者為T細胞最初發育的器官？', o: ['淋巴結', '脾臟', '胸腺', '肝臟'], a: 'C' },
            { q: '下列何者屬於減毒之活病毒疫苗？', o: ['B型肝炎疫苗', '狂犬病疫苗', '破傷風疫苗', '小兒麻痺沙賓疫苗'], a: 'D' },
            { q: '有關金黃色葡萄球菌（ Staphylococcus aureus） 感染所造成的臨床表徵， 下列何者症狀通常不是由其分泌的毒素所導致？', o: ['猛爆性紫斑病（ purpura fulminans）', '葡萄球菌食物中毒（ food poisoning）', '心內膜炎（ endocarditis）', '葡萄球菌燙傷狀皮膚症候群（ staphylococcal scalded skin syndrome）'], a: 'C' },
            { q: '病人最近得到泌尿道感染， 醫師利用革蘭氏染色法檢驗尿液中的細菌， 染到與番紅（ safranin） 呈現相同顏色的一株細菌， 下列針對這株細菌的敘述， 何者錯誤？', o: ['可能是大腸桿菌（ E. coli）', '可能會產生內孢子（ endospore）', '應該具有內毒素（ endotoxin）', '可能缺少壁脂酸（ lipoteichoic acid） 的結構'], a: 'B' },
            { q: '有關花斑癬（ Pityriasis versicolor） 之敘述， 下列何者正確？', o: ['其病原菌馬拉色氏菌（ Malassezia） 平常不會在健康人皮膚上', '是一種嗜脂性黴菌', '不會形成菌絲', '為造成血液感染主要的病原真菌'], a: 'B' },
            { q: '有關腺病毒（ adenovirus） 的敘述， 下列何者錯誤？', o: ['腺病毒感染會造成結膜炎、呼吸道感染或腸胃炎', '腺病毒的感染以大人居多， 小孩感染的病例較少', '腺病毒的基因體是DNA', '腺病毒目前並無特定抗病毒藥物可以治療'], a: 'B' },
            { q: '下列何種RNA病毒沒有上市的疫苗可預防其感染？', o: ['輪狀病毒', '小兒麻痺病毒', '麻疹病毒', 'C型肝炎病毒'], a: 'D' },
            { q: '下列何種症狀最常出現於非洲錐蟲病（ African trypanosomiasis） 病人的急性期臨床表現？', o: ['昏迷和抽搐', '高燒和昏睡', '無法集中注意力和失去平衡', '發熱、肌肉疼痛、關節疼痛和淋巴結腫大'], a: 'D' }
        ];

        // 使用 transaction 確保資料一致性
        db.run('DELETE FROM quizzes WHERE subject = ?', [subjectBM], function(err) {
            if (err) {
                console.error('刪除舊基礎醫學題目失敗:', err.message);
                return;
            }
            console.log(`已清除舊的 '${subjectBM}' 題目`);

            const stmt = db.prepare('INSERT INTO quizzes (subject, question, option_a, option_b, option_c, option_d, correct_answer) VALUES (?, ?, ?, ?, ?, ?, ?)');
            quizzesBM.forEach(item => {
                stmt.run(subjectBM, item.q, item.o[0], item.o[1], item.o[2], item.o[3], item.a);
            });
            stmt.finalize(err => {
                if (err) {
                    console.error('插入基礎醫學題目失敗:', err.message);
                } else {
                    console.log(`已成功插入 ${quizzesBM.length} 題 '${subjectBM}' 題目`);
                }
            });
        });

        // --- 基本護理學 ---
        const subjectBN = '基本護理學';
        const quizzesBN = [
            { q: '依據疾病自然史發展， 在疾病的易感染期欲將危險因子去除或減至最低， 可提供何種預防方法？', o: ['早期診斷早期治療', '促進健康', '限制殘障', '復健'], a: 'B' },
            { q: '有關內科無菌技術的敘述， 下列何者正確？', o: ['為避免交互感染， 可以戴手套來取代洗手', '高於肘部的刷手為一種內科無菌技術', '綁帶式外科口罩上下兩條帶子均需繫上， 須同時蓋住口、鼻部', '指執行侵入性治療時， 保持滅菌物品或無菌區域無菌狀態的技術'], a: 'C' },
            { q: '手術縫合針使用後以容器收集， 應使用下列何種醫療廢棄物處置方式處理？', o: ['福馬林消毒', '冰凍處理後掩埋', '滅菌後粉碎', '紫外線消毒'], a: 'C' },
            { q: '病房中設有護理師專門負責所有病人的傷口換藥工作， 屬於下列何種工作模式？', o: ['全責護理', '成組護理', '功能性護理', '個案護理'], a: 'C' },
            { q: '護理計畫的健康問題優先順序的排列原則， 下列何者錯誤？', o: ['威脅病人生命的須優先解決', '護理人員覺得最重要的優先解決', '依馬斯洛（ Maslow） 的需要層次理論排列', '相關的護理問題儘量排在一起'], a: 'B' },
            { q: '下列何者是護理評估的客觀資料（ objective data, O）？', o: ['家屬：「我媽媽血壓偏低」', '病人：「清晨2～ 3點才入睡」', '護理師：「白血球10, 000 /mm3」', '看護：「病人一直在叫痛」'], a: 'C' },
            { q: '下列何者是相依性護理活動？', o: ['執行每日疼痛評估', '靜脈輸注PRBC 2U STAT', '肌肉注射PRN止痛藥物', '教導病人胰島素注射方法'], a: 'C' },
            { q: '有關完全電子病歷優點的敘述， 下列何者錯誤？', o: ['資料可供同體系共享， 維持資料一致性', '醫療流程管制與修改方便， 且不會留有紀錄', '資料完善， 具結構化， 可促進醫學研究', '不必有紙本病歷， 可以減少醫院的成本'], a: 'B' },
            { q: '病人抱怨：「你們醫院的高血壓藥品質不好， 吃了好像都沒有效果！」護理人員回覆：「不會吧！我們醫院的藥物都是用最好的。」護理人員的回覆為下列何種非治療溝通技巧？', o: ['過度負荷', '批判的態度', '防衛性態度', '改變話題'], a: 'C' },
            { q: '下列何者為執行一次就自動失效的醫囑？ ①Dulcolax 1# supp. HS ②Ketoprofen 1 amp. I.M. STAT ③Valium 1# P.O. HS SOS ④Demerol 40 mg I.M. Q6H PRN', o: ['①③', '①④', '②③', '②④'], a: 'C' },
            { q: '小樂3歲， 持續發燒不適， 拒絕服藥， 醫師開立Voren® 12.5 mg/supp 1# supp. STAT， 護理師衛教小樂媽媽肛門栓劑的使用， 下列敘述何者錯誤？', o: ['肛門栓劑應保存在冰箱中冷藏', '可在栓劑前端塗抹少量潤滑劑', '栓劑插入肛門內約2吋深', '塞入後維持原姿勢或右側臥15分鐘'], a: 'D' },
            { q: '就藥物劑型而言， 下列口服藥物何種吸收最快？', o: ['acetylcysteine powders', 'acetaminophen tablet', 'brown mixture syrup', 'ampicillin capsule'], a: 'C' },
            { q: '醫囑開立oxacillin 1 gm Q6H I.V. drip， oxacillin藥瓶標示為250 mg/vial， 每次給藥時應抽幾瓶（ vial）？', o: ['1', '2.5', '4', '6'], a: 'C' },
            { q: '下列靜脈輸液何者不是低張溶液？', o: ["0.33% NaCl", "Lactated Ringer's solution", "Half Saline", "2.5% Glucose Water"], a: 'B' },
            { q: '有關「靜脈採血」的執行步驟， 下列何者正確？', o: ['成人可使用27號針頭抽血', '避免從正接受靜脈輸液治療的部位抽血', '以酒精棉球消毒後， 以手搧風加速酒精揮發', '將抽得的血液沿著試管壁快速注入， 並充分搖晃試管'], a: 'B' },
            { q: '病人因泌尿道感染， 醫囑： Gentamycin® 10 mg in N/S 30 mL drip 30 min， 有關使用精密輸液套管加藥的步驟， 下列敘述何者錯誤？', o: ['打開輸液瓶與精密輸液袋（ bag） 間之阻斷夾， 以手擠壓精密輸液袋（ bag） 到所需之量， 關閉阻斷夾', '精密輸液袋（ bag） 內之溶液到所需之輸液量後， 關閉輸液瓶與精密輸液袋（ bag） 間之阻斷夾', '以酒精棉片消毒精密輸液袋（ bag） 加藥口， 將藥物注入精密輸液袋（ bag）', '藥物滴完後， 打開輸液瓶與精密輸液袋（ bag） 間之阻斷夾， 使精密輸液袋（ bag） 內流入適量溶液， 沖洗輸液管路'], a: 'A' },
            { q: '有關溫水坐浴（ Warm Sitz Bath） 常用溶液及其使用目的之敘述， 下列何者錯誤？', o: ['1： 8水溶性優碘（ Beta-iodine）， 用於產後會陰部傷口之消毒', '1： 4,000高錳酸鉀（ P.P. solution）， 用於肛門、會陰部傷口的消腫與抑菌', '10～ 50%硫酸鎂（ MgSO4）， 用於痔瘡切除術後傷口， 具有收斂作用', '38～ 40℃之溫水， 用於清潔及促進傷口癒合'], a: 'A' },
            { q: '有關冷療的應用， 下列何者正確？ ①濕冷敷較乾冷的穿透力佳， 對組織的傷害亦較小 ②冰袋及冰枕， 不能直接用於皮膚 ③冰領適用於甲状腺術後的止痛與止血 ④臨床上低溫毯用於心臟手術病人的目的是促進新陳代謝率', o: ['①②', '①③', '②③', '③④'], a: 'C' },
            { q: '有關臥姿與其目的之敘述， 下列何者正確？', o: ['採俯臥式可預防髖部關節攣縮', '採屈膝仰臥式可改善子宮後傾引起的經痛', '仰臥姿可用於接受痔瘡切除術病人', '採膝胸臥姿可促使下腹部感染局部化'], a: 'A' },
            { q: '有關灌腸的相關敘述， 下列何者正確？', o: ['保留灌腸溶液需在腸道內保留5〜10分鐘', '保留灌腸常用於協助病人解除便秘', '麻醉劑可使用保留灌腸方式給與', '清潔灌腸是最常見的保留灌腸'], a: 'C' },
            { q: '有關尿液性質的敘述， 下列何者錯誤？', o: ['泌尿道感染病人尿液中的白血球可能高於正常值', '糖尿病病人的尿液中可能出現葡萄糖', '長期嘔吐者的尿液中可能出現酮體', '肝臟疾病者的尿液中可能出現圓柱體'], a: 'D' },
            { q: '下列何種設備， 能有效協助呼吸困難的病人維持舒適姿勢？', o: ['床上護架', '床上桌', '氣墊床', '蛋型床墊'], a: 'B' },
            { q: '肺癌合併胸椎、肋骨等多處骨頭轉移的病人， 皮膚乾燥， 因長期臥床導致足部靜脈栓塞。護理師協助病人沐浴與身體按摩， 下列照護何者適當？', o: ['以41～ 43℃溫水擦澡後， 再塗擦乳液', '清潔四肢時， 由近心端往遠心端擦拭', '沐浴後， 協助背部叩擊增進舒適', '協助熱水足浴後， 進行足部按摩'], a: 'A' },
            { q: '病人發燒時的護理措施， 下列何者最不適當？', o: ['每4小時或更密切的監測體溫', '協助調節室溫27～ 28℃', '增加水分攝取， 至少3,000 mL/day', '給與口腔護理'], a: 'B' },
            { q: '關於影響呼吸頻率的因素， 下列敘述何者錯誤？', o: ['年齡越小， 呼吸越快', '體溫下降， 呼吸減慢', '血壓下降， 呼吸減慢', '高海拔地區， 呼吸越快'], a: 'C' },
            { q: '使用水銀血壓計測量成人血壓時， 於數值140 mmHg時開始聽到輕敲聲， 至130 mmHg時開始聽到更清脆更強的敲聲， 至70 mmHg時轉為較低沉聲音， 至56 mmHg時聲音消失， 其血壓值紀錄， 下列何者正確？', o: ['140/70 mmHg', '130/70 mmHg', '140/56 mmHg', '130/56 mmHg'], a: 'C' },
            { q: '下咽癌病人行全咽喉切除術， 併放射線療法後食道狹窄， 下列何種方式最適合病人的長期腸道營養支持？', o: ['由口進食', '鼻胃管灌食', '胃造口灌食', '腸造口灌食'], a: 'C' },
            { q: '病人因車禍接受右側膝關節上方的截肢手術， 下列何者最適用於術後殘肢包紮？', o: ['使用環形包紮法， 再以8字形包紮法定帶', '使用8字形包紮法， 再以人字形包紮法定帶', '使用緩螺旋包紮法， 再以回反摺形包紮法定帶', '使用回反摺形包紮法， 再以環形包紮法定帶'], a: 'D' },
            { q: '病人左側肢體無力， 有關協助病人坐入輪椅的敘述， 下列何者正確？ ①下床前， 需測量病人脈搏、呼吸， 並視需要量血壓 ②將輪椅放在病人左側床尾， 輪椅置於與床尾之間呈90度角處 ③護理師協助病人移動時， 身體重心離病人越遠會越省力 ④教導病人要準備坐下輪椅前， 先將身體微前傾， 再緩慢彎曲膝關節， 使重心下降', o: ['②③', '②④', '①②', '①④'], a: 'D' },
            { q: '有關壓力性損傷（ 壓瘡） 形成因素的敘述， 下列何者錯誤？', o: ['當壓力高於組織中血管的壓力時將阻礙血流供應， 造成組織缺氧', '相同的刺激， 受壓面積越大對組織的傷害越大', '長時間承受小的壓力比短時間承受大的壓力傷害還大', '剪力是造成深層組織壓力性損傷（ 壓瘡） 的重要因素'], a: 'B' },
            { q: '構成牙齒及骨骼的礦物質， 除了鈣之外， 主要成分還包括以下何者？ ①鋅 ②鉀 ③鎂 ④磷', o: ['①②', '③④', '①④', '②③'], a: 'B' },
            { q: '臺灣立法保障尊重自然死， 下列有關「安寧緩和醫療條例」的敘述何者正確？', o: ['末期病人才可以簽署「預立安寧緩和醫療暨維生醫療抉擇意願書」', '意識昏迷「無最近親屬者」（ 如單身無親者）， 轉介社工由轄區里長填具「不施行心肺復甦術同意書」', '意願人得預立醫療委任代理人， 並以書面載明， 於其無法表達意願時， 由代理人代為簽署意願書', '意識昏迷者， 有最近親屬代理簽署「不施行心肺復甦術同意書」， 父母排序優先於配偶'], a: 'C' },
            { q: '有關臨終病人的護理措施， 下列何者正確？ ①協助個案減少不適 ②病房環境應昏暗， 以減少對眼睛的刺激 ③與個案說話要清楚、緩慢， 以免增加其焦慮 ④避免個案使用止痛劑， 預防成癮', o: ['①③', '②④', '②③', '①④'], a: 'A' },
            { q: '護理人員執行遺體護理時， 下列措施何者正確？', o: ['有鼻胃管者須先引流後再移除管路', '如有假牙者， 需在屍僵發生後再裝上', '將病人遺體側臥以利口腔分泌液引流', '用30℃的溫水擦拭病人遺體'], a: 'A' },
            { q: '以普通針具收集血液標本， 進行常規檢查， 下列敘述何者正確？ ①通常採動脈血進行血球計數的標本 ②若檢測血糖、膽固醇等病人須先禁食 ③針筒血液需沿著試管壁以45度角注入 ④血液注入試管內需快速用力搖動以能與抗凝劑相融合', o: ['①②', '②③', '③④', '①④'], a: 'B' },
            { q: '有關使命或任務之敘述， 下列何者正確？', o: ['是做策略性規劃的最後步驟', '應以顧客的需要為主要依據', '應依據評鑑標準之要求訂定', '為指引員工行為的基本準則'], a: 'B' },
            { q: '彼得杜拉克（ Peter F. Drucker） 提出的目標管理， 屬於下列何種管理模式？', o: ['參與式管理', '權威式管理', '放任式管理', '民主式管理'], a: 'A' },
            { q: '有關管理理論之敘述， 下列何者正確？', o: ['修正管理理論和傳統管理理論主要差異在參與式決策和團體價值觀', '行為科學學派著重人性化管理， 以日本企業管理的Z理論最具代表性', '管理程序學派重視全盤性經營管理， 以戴明（ Deming） 為代表性人物', '管理科學學派主張運用數學計量處理問題， 所有效益都用數字來表示'], a: 'D' },
            { q: '某地區醫院一年的總營業收入為1,000萬元， 變動成本為600萬元， 固定成本為400萬元， 其損益平衡點為多少萬元？', o: ['200', '400', '600', '1,000'], a: 'D' },
            { q: '護理長於年度考核前一週， 與平時工作表現良好且深獲肯定的護理師起爭執， 故給予該名護理師較低的考評分數。此行為屬於下列何種績效考核問題？', o: ['寬厚錯誤', '向日葵效應', '膨脹壓力', '觸角效應'], a: 'D' },
            { q: '有關病人分類系統的實施原則， 下列敘述何者最適當？', o: ['要確保資料的完整性， 不宜設置稽核機制', '考量臨床實務， 不宜太重視分類量表的信效度', '方便易操作， 不可影響臨床護理照護時數', '為強化效益， 分類系統應採單一功能發展'], a: 'C' },
            { q: '某護理之家員工共計100人， 去年每位員工工作240天， 有25人請假， 共計請假60天， 則該機構去年缺勤率為何？', o: ['0.10%', '0.25%', '1.00%', '2.50%'], a: 'B' },
            { q: '有關集權式組織的優點， 下列敘述何者正確？', o: ['減少工作重複及成本', '員工覺得自由受尊重', '職權和職責階層完整', '部門間容易相互溝通'], a: 'A' },
            { q: '某病房以病人照護技術需求為工作分配原則， 屬於下列何種護理照護模式？', o: ['成組護理', '功能護理', '綜合護理', '個案護理'], a: 'B' },
            { q: '有關護理師常見的人因性職業傷害， 下列何者錯誤？', o: ['下肢血管靜脈曲張', '背部扭拉傷', '自律神經失調', '椎間盤凸出'], a: 'C' },
            { q: '對於工作意願低， 工作能力也低的員工， 下列何種管理策略最為適當？', o: ['移轉策略', '激發策略', '增強策略', '發展策略'], a: 'A' },
            { q: '有關資訊系統能提升護理效能的敘述， 下列何者正確？ ① 使用條碼辨識病人， 可減少給藥三讀五對流程 ②減少護理紀錄重複抄寫時間 ③增進護理管理效率 ④衛教資料資訊化， 不用花費時間衛教', o: ['①②', '②③', '③④', '①④'], a: 'B' },
            { q: '應用PDCA（ Plan-Do-Check-Act） 於老人跌倒品質改善， 下列何者正確？', o: ['Plan： 依照事先想好的計畫執行老人跌倒預防措施', 'Do： 擬定改善老人跌倒計畫及執行預防措施', 'Check： 查核跌倒評估的落實度及浴廁扶手使用率', 'Act： 依照跌倒原因採取可行的行動方案'], a: 'C' },
            { q: '有關問題解決的原則， 下列敘述何者正確？', o: ['主管親自解決問題以縮短處理時間', '避免透過外部專家協助處理以免影響聲譽', '優先處理影響組織利益最大的問題', '主管須注意小細節以免問題再發生'], a: 'C' },
            { q: '因醫療處置結果不如預期而產生之醫療糾紛的處理原則， 下列何者應優先？', o: ['請醫院院長應立即出面道歉', '收集發生醫療不良結果之前例', '勇敢出來誠實面對病人或家屬', '說明任何醫療行為均可能有風險'], a: 'C' }
        ];

        db.run('DELETE FROM quizzes WHERE subject = ?', [subjectBN], function(err) {
            if (err) {
                console.error('刪除舊基本護理學題目失敗:', err.message);
                return;
            }
            console.log(`已清除舊的 '${subjectBN}' 題目`);

            const stmt = db.prepare('INSERT INTO quizzes (subject, question, option_a, option_b, option_c, option_d, correct_answer) VALUES (?, ?, ?, ?, ?, ?, ?)');
            quizzesBN.forEach(item => {
                stmt.run(subjectBN, item.q, item.o[0], item.o[1], item.o[2], item.o[3], item.a);
            });
            stmt.finalize(err => {
                if (err) {
                    console.error('插入基本護理學題目失敗:', err.message);
                } else {
                    console.log(`已成功插入 ${quizzesBN.length} 題 '${subjectBN}' 題目`);
                }
            });
        });

        // --- 內外科護理學 ---
        const subjectMS = '內外科護理學';
        const quizzesMS = [
            { q: '有關巴金森氏症病人服用抗膽鹼激性製劑trihexyphenudyl（ Artane®） 之敘述， 下列何者正確？', o: ['長期服用會出現姿位型低血壓', '副作用少見， 偶有情緒改變和頭痛情形', '常與抗病毒製劑合併使用， 可有效控制失眠和頭痛', '需要監測眼壓變化， 預防青光眼'], a: 'D' },
            { q: '多發性硬化症病人之日常活動護理指導， 下列敘述何者正確？', o: ['運動前給予溫熱敷會增加肌肉強直和關節攣縮', '避免在運動後洗熱水澡以免疾病惡化', '可以增加多次且密集的運動， 防止肌肉無力和強直', '若疾病加重導致長期臥床， 應避免執行全關節運動'], a: 'B' },
            { q: '有關頭部外傷相關合併症的敘述， 下列何者正確？', o: ['封閉性比開放性頭部外傷更易產生癲癇後遺症', '創傷後症候群症狀可持續數個月到數年', '腦脊髓液瘻管是因腦脊髓液循環路徑阻塞或吸收有問題', '當頭部外傷損及視丘時， 會引起抗利尿激素（ ADH） 分泌失調'], a: 'B' },
            { q: '有關癲癇（ epilepsy） 發作處置， 下列敘述何者錯誤？', o: ['電腦斷層檢查可確定異常放電位置', '發作時， 可將頭偏向一側以利唾液流出', '發作時， 若病人意識不清， 不須試圖喚醒病人', '驟然停藥為重積性癲癇常見的原因'], a: 'A' },
            { q: '有關左側大腦損傷可能引起的功能缺失症狀， 下列敘述何者正確？ ①計算能力降低 ②空間缺損 ③半側忽略 ④語言障礙', o: ['①②', '①④', '②③', '③④'], a: 'B' },
            { q: '有關胃食道逆流症的護理指導， 下列敘述何者錯誤？', o: ['進食後應立即平躺', '避免在睡前2～ 3小時進食', '少量多餐細嚼慢嚥', '肥胖的病人應減重'], a: 'A' },
            { q: '有關大腸癌的高危險因子， 下列敘述何者正確？', o: ['常攝取蔬菜及高纖維質', '幽門螺旋桿菌感染', '有家族型腺瘤性息肉症病史', '胃酸分泌過多症'], a: 'C' },
            { q: '肝性腦病變的病人給與Lactulose的目的， 下列何者正確？', o: ['酸化糞便以減少氨在腸道吸收', '抑制腸內細菌以減少氨的分解', '預防發生肝腎症候群', '減輕腹水的產生'], a: 'A' },
            { q: '有關胰臟炎急性發作及其治療的敘述， 下列何者錯誤？', o: ['上腹部中央疼痛或輻射到背部， 疼痛為突發、持續且劇烈', '血清澱粉酶（ amylase） 升高、脂肪酶（ lipase） 上升、血鈣下降', '放置鼻胃管的目的為抽出胰澱粉酶， 以避免發炎加劇', '當病情穩定可開始進食時， 應採低脂肪、低蛋白、高醣飲食'], a: 'C' },
            { q: '有關食道憩室的敘述， 下列何者正確？', o: ['常見胸口灼熱感症狀', '可做鋇劑食道攝影確定位置', '餐後平躺可減緩不適', '一旦發生須儘速以手術治療'], a: 'B' },
            { q: '有關痛風性關節炎護理指導之敘述， 下列何者正確？', o: ['避免服用Aspirin， 以預防血中尿酸升高', '採取高脂飲食， 以促進尿酸鹽排出', '多喝小紅莓汁， 以預防尿酸結石產生', '多攝取肉汁、海鮮， 以促進嘌呤代謝'], a: 'A' },
            { q: '有關肌肉骨骼系統身體檢查評估結果之敘述， 下列何者正確？', o: ['湯瑪斯試驗（ Thomas test） 陽性反應表示病人對側髖關節攣縮', '浮動試驗（ Ballottement test） 陽性表示病人膝半月板有損傷', '抽拉試驗（ Drawer test） 若能將小腿向後牽引6mm表示副韌帶鬆弛', '廷內爾氏徵象（ Tinel\'s sign） 陽性反應表示後十字韌帶鬆弛'], a: 'A' },
            { q: '有關骨質疏鬆症處置之敘述， 下列何者正確？', o: ['每日飯前服用碳酸鈣（ calcium carbonate）， 以增加鈣吸收', '鼓勵日曬及攝取維生素D， 以促進鈣吸收', '每日飯後服用雙磷酸鹽類（ bisphosphonates）， 以減少骨流失', '每天使用副甲狀腺素（ teriparatide） 鼻噴劑， 以增加骨質量'], a: 'B' },
            { q: '下列何者為充滿血管可以供應眼球及視網膜血液及營養的構造？', o: ['鞏膜', '角膜', '脈絡膜', '睫狀體'], a: 'C' },
            { q: '有關扁桃腺炎（ tonsilitis） 病人接受扁桃腺切除術之敘述， 下列何者錯誤？', o: ['急性發炎期時應儘快安排手術', '術前可用溫食鹽水漱口， 減輕咽喉不適', '疑似扁桃腺腫瘤是手術適應症', '術後有持續吞嚥動作時， 可能為傷口出血的現象'], a: 'A' },
            { q: '進行心臟復健時如出現活動耐力不足時應停止， 下列何者不是其判斷依據？', o: ['心律不整或心跳上升或下降超過20次／ 分鐘以上', '血壓上升或下降超過20 mmHg以上', '體溫大於37℃', '出現胸悶、胸痛、眩暈、盜汗、虛弱、疲倦'], a: 'C' },
            { q: '有關裝置永久性心臟節律器病人居家護理指導之敘述， 下列何者錯誤？', o: ['每天需測量橈動脈1分鐘', '住家頂樓避免裝設手機基地台', '可使用微波爐， 但應保持安全距離', '持續打嗝時， 可做伐式操作法（ Valsalva） 緩解'], a: 'D' },
            { q: '有關心衰竭之敘述， 下列何者正確？', o: ['右心衰竭會出現心搏過速、心室肥大、第三心音', '右心衰竭常出現乾咳或帶有泡沫及血絲痰', '左心衰竭早期徵象是下肢水腫、頸靜脈怒張、腹水', '左心衰竭常見症狀為呼吸困難、端坐呼吸'], a: 'D' },
            { q: '有關急性心肌梗塞引起的心因性休克給予的藥物處置， 下列敘述何者錯誤？', o: ['Dobutamine滴注可以增加心肌收縮力及心輸出量', '利尿劑主要目的為降低心臟前負荷', '嗎啡主要是緩解疼痛， 對心臟前、後負荷沒有影響', '血管擴張劑nitroglycerin（ NTG） 滴注可以擴張周邊血管而減輕心臟負荷'], a: 'C' },
            { q: '有關靜脈剝除結紮手術（ stripping and ligation） 術後照護之敘述， 下列何者錯誤？', o: ['術後臥床期間避免於床上進行全範圍關節運動', '抬高床尾15度， 膝部不彎曲', '術後下床時均應穿彈性襪', '應監測末梢血循變化及是否有感覺異常'], a: 'A' },
            { q: '正在接受體外放射線治療的癌症病人表示：「臉和頸部的皮膚發紅刺痛、脫屑， 甚至有些部位會濕濕的， 很不舒服」， 下列處置何者正確？', o: ['清水洗淨後塗擦凡士林保濕', '可局部溫濕敷以緩解不適症狀', '0.9% N/S沖洗後以親水敷料（ DuoDerm） 覆蓋', '刮鬍子時用刮鬍膏潤滑刮鬍刀以免刮傷'], a: 'C' },
            { q: '顆粒性白血球低下的癌症病人之食物選擇， 下列何者最適切？', o: ['溏心蛋： 補充單白質', '泡菜： 補充纖維質防便秘', '柑橘： 補充維生素C', '優格： 補充鈣質、維生素'], a: 'C' },
            { q: '中樞神經系統癌症病人， 若選用難以通過血腦障壁之化學治療時， 下列何者為最適切之給藥途徑？ ①Port-A ②Ommaya reservoir ③Hickman catheter ④intrathecal injection', o: ['①③', '①④', '②③', '②④'], a: 'D' },
            { q: '為一位乳癌骨轉移合併脊髓壓迫的病人進行身體評估時， 下列症狀或徵象何者最不常出現？', o: ['背部疼痛指數7分（ 滿分10分）', '布魯辛斯基氏徵象（ Brudzinski\'s sign） 陽性', '大小便失禁情形', '巴賓斯基氏徵象（ Babinski\'s sign） 陽性'], a: 'B' },
            { q: '下列何者接受自體移植治療後的5年存活率最高？', o: ['急性骨髓性白血病第一次完全緩解後接受自體骨髓移植', '急性骨髓性白血病第一次完全緩解後接受自體周邊血液幹細胞移植', '急性淋巴性白血病第一次完全緩解後接受自體骨髓移植', '急性淋巴性白血病第一次完全緩解後接受自體周邊血液幹細胞移植'], a: 'A' },
            { q: '有關致癌因子及其相關癌症的敘述， 下列何者需進一步提供護理指導以澄清誤解？', o: ['「我看你還是少吃點檳榔吧， 不然口腔癌可能會找上你喔」', '「平時喝酒適量即可， 過量可能會導致肝癌、乳癌、食道癌的發生」', '「我老公平時是油漆工， 聽說長時間接觸那些苯胺染料， 可能和膀胱癌的發生有關」', '「上次我去看醫師， 他跟我說我有幽門螺旋桿菌， 可能和食道癌的發生有關」'], a: 'D' },
            { q: '有關帶狀疱疹臨床症狀之敘述， 下列何者正確？', o: ['帶状小水疱群聚常會環繞軀幹一圈', '最常發生在頭頸部', '口腔有乳白色的斑塊', '淋巴腺腫與水疱同時發生、同時消失'], a: 'D' },
            { q: '有關皮膚腫瘤之敘述， 下列何者正確？', o: ['表皮囊腫（ epidermal cysts） 是一種惡性腫瘤， 通常包裹著乳白色的粉狀物質', '脂漏性角化症（ seborrheic keratoses） 是一種良性的表皮角質過度增生', '纖維瘤（ fibroma） 是一種脂肪細胞常見的腫瘤', '蜘蛛狀血管瘤（ spider hemangioma） 與血液中黃體激素升高有關'], a: 'B' },
            { q: '林先生因熱燒傷接受植皮手術， 有關術後注意事項之敘述， 下列何者正確？', o: ['供皮區應使用石膏夾板固定至少3～ 7天', '術後應鼓勵病人移植部位多接受日照', '肩部燒傷應使病人採俯臥， 手臂位置遠離身體', '膝蓋受傷部位應採屈曲姿位， 膝下墊一枕頭'], a: 'C' },
            { q: '有關後天免疫缺乏症候群（ AIDS） 臨床表徵之敘述， 下列何者錯誤？', o: ['急性HIV感染可能出現類感冒症狀如淋巴腺腫大、發燒、肌肉關節疼痛', '臨床潛伏期可能持續10年或更長時間', '卡波西氏肉瘤是愛滋病人最常見的惡性腫瘤', '愛滋病人可能出現口腔紅斑症'], a: 'D' },
            { q: '為降低排斥反應， 下列何者為器官移植前進行組織配對的常見檢驗？ ①C型肝炎檢驗 ②人類白血球抗原（ HLA） ③混和性淋巴細胞反應 ④交叉配對試驗 ⑤人類免疫缺乏病毒（ HIV） 篩檢', o: ['①②③', '①④⑤', '②③④', '③④⑤'], a: 'C' },
            { q: '病人因車禍送到急診， 身體評估出現下列何者時， 應懷疑可能有氣胸？', o: ['一側聽不到呼吸音或呼吸音減弱', '二側肺葉有喘鳴音', '二側肺葉於吸氣時聽到囉音', '一側肺葉叩診出現濁音'], a: 'A' },
            { q: '有關急性呼吸窘迫症候群（ ARDS） 之敘述， 下列何者正確？', o: ['因為外分泌腺分泌異常， 而導致黏液聚集在肺泡中', '因為肺部疾病， 而引起右心肥大與肥厚', '因為肋膜腔內積聚空氣， 而導致肺部塌陷', '因為肺泡微血管膜的通透性受損， 而產生肺水腫'], a: 'D' },
            { q: '下列何者不屬於動脈血液氣體分析（ arterial blood gas analysis） 可以直接偵測之項目？', o: ['呼吸困難', '酸鹼度', '重碳酸鹽含量', '血氧飽和度'], a: 'A' },
            { q: '下列何種給氧方式能提供最高的氧氣吸入濃度（ FiO2）？', o: ['卞德里面罩', '單純型面罩', '氧氣鼻套管', '非再吸入面罩'], a: 'D' },
            { q: '有關肺膿瘍病人的護理評估， 下列何者最可能出現？', o: ['呼吸音減弱有時會出現肋膜摩擦音', '叩診出現鼓音', '上肺葉吸氣期出現喘鳴音', '叩診出現過度反響音'], a: 'A' },
            { q: '有關高血鉀導因之敘述， 下列何者正確？ ①使用血管收縮素轉換酶抑制劑 ②使用醛固酮拮抗劑 ③使用噻嗪類利尿劑（ thiazide diuretics） ④代謝性鹼中毒', o: ['①②', '①④', '②③', '③④'], a: 'A' },
            { q: '尿液分析中出現紅血球的病因， 下列何者錯誤？', o: ['輸尿管結石', '前列腺肥大', '子癲前症', '尿路感染'], a: 'C' },
            { q: '陳先生， 88歲， 因全身水腫， 呼吸喘至急診求治， 診斷為急性腎衰竭， 下列敘述何者正確？', o: ['血鉀7.5 mg/dL， 心電圖T波低而寬長', '可能因前列腺肥大， 導致腎性急性腎衰竭', '24小時尿量約300 c.c.， 正處於腎衰竭少尿期', '腎臟超音波檢查， 顯示雙側腎臟大小為7.5 cm'], a: 'C' },
            { q: '有關腎臟功能檢測血清肌酸酐（ creatinine） 之敘述， 下列何者錯誤？', o: ['易受飲食影響可用以估算排泄能力', '是用來估算腎臟功能最佳指標', '升高時代表腎功能已損傷50%以上', '升高時代表腎絲球過濾率功能已降低'], a: 'A' },
            { q: '有關預防泌尿道感染復發的護理指導， 下列何者錯誤？', o: ['減少不必要的導尿管留置', '排便後， 應由前往後擦拭', '洗澡避免盆浴， 儘量採淋浴', '症狀減輕沒發燒就可以停藥'], a: 'D' },
            { q: '有關糖尿病酮酸中毒（ DKA） 之處置， 下列何者正確？ ①建立靜脈輸液， 由低劑量胰島素開始給與 ②最初2小時， 給與0.45％ 生理食鹽水維持電解質平衡 ③等尿液排出量恢復正常， 應補充鉀離子 ④血液pH值>7.1時， 則與以重碳酸鈉（ NaHCO3）', o: ['①②', '①③', '②④', '③④'], a: 'B' },
            { q: '有關服用治療甲狀腺機能亢進之放射性碘（ 131I） 的敘述， 下列何者正確？', o: ['食物會延遲放射性碘（ 131I） 吸收， 服用前一天午夜後及服用後2小時應禁食， 以利吸收', '服用治療劑量於8～ 30 μ Ci 的病人應限制訪客， 第一週最好單獨睡， 避免接觸孕婦', '服用一個星期後會經由尿液、糞便排出， 這段時間在使用馬桶後， 宜沖水2～ 3次', '服用高劑量者10年後易出現甲狀腺功能亢進， 故需定期追蹤血清T3是否上升'], a: 'B' },
            { q: '有關肢端肥大症之症狀， 下列何者錯誤？', o: ['泌尿系統： 低血鈣症、腎結石', '骨骼系統： 關節痛、肌肉無力', '神經系統： 腕隧道症候群、嗜睡', '皮膚系統： 皮膚增厚、油脂增多'], a: 'A' },
            { q: '有關尿崩症病人之護理處置， 下列何者錯誤？', o: ['應鼓勵病人多喝開水， 以維持水分和體液電解質的平衡', '噴灑鼻噴劑型desmopressin時， 教導病人應吸氣以增加藥效', '腎因性尿崩症應給與Thiazide利尿劑及限鹽攝取， 以緩解症狀', 'Vassopressin Tannate是油性懸浮液， 抽藥前需先溫熱與搖勻'], a: 'B' },
            { q: '有關糖尿病足病人運動時鞋襪選擇之建議， 下列何者錯誤？', o: ['楦頭要寬， 可讓腳趾自由伸展', '穿鞋前要先檢查鞋內有無異物', '襪子選擇棉質易吸汗為佳', '運動時需穿鞋保護雙足， 偶爾不穿襪沒關係'], a: 'D' },
            { q: '有關2020年美國心臟醫學會（ American Heart Association, AHA） 公告準則， 啟動院內心臟停止（ IHCA） 生命之鏈（ chain of survival） 的次序， 下列何者正確？ ①提供高品質心肺復甦 ②去顫 ③早期監測與預防 ④心臟驟停後照護 ⑤復原 ⑥啟動緊急應變系統', o: ['①→②→③→⑥→⑤→④', '③→⑥→①→②→④→⑤', '⑥→①→③→②→④→⑤', '⑥→②→③→①→⑤→④'], a: 'B' },
            { q: '72歲男性， 有心臟病病史， 夏天逛露天賣場時不明原因昏倒， 臉色潮紅， 皮膚乾熱， 呼吸24次／分， 脈搏強而快， 體溫41.5℃， 下列何者為其最可能診斷？', o: ['熱中暑（ heat stroke）', '熱性痙攣（ heat cramp）', '熱衰竭（ heat exhaustion）', '熱暈厥（ heat syncope）'], a: 'A' },
            { q: '有關輸血品項與適應症之敘述， 下列何者錯誤？', o: ['血小板濃厚液適用於治療血小板減少症', '2單位紅血球濃厚液適用於提高成年人血色素約1～ 1.2 gm/dL', '全血適用於過敏性休克病人', '新鮮冷凍血漿適用於發生瀰漫性血管內凝血之病人'], a: 'C' },
            { q: '有關登革熱的敘述， 下列何者正確？', o: ['臉部出現不痛不癢的紅斑', '病毒從呼吸道檢體分離是確診的主要依據', '為第三類法定傳染病', '馬鞍狀發燒， 發燒3天後體溫下降1～ 2天後， 又再度發燒'], a: 'D' }
        ];

        db.run('DELETE FROM quizzes WHERE subject = ?', [subjectMS], function(err) {
            if (err) {
                console.error('刪除舊內外科護理學題目失敗:', err.message);
                return;
            }
            console.log(`已清除舊的 '${subjectMS}' 題目`);

            const stmt = db.prepare('INSERT INTO quizzes (subject, question, option_a, option_b, option_c, option_d, correct_answer) VALUES (?, ?, ?, ?, ?, ?, ?)');
            quizzesMS.forEach(item => {
                stmt.run(subjectMS, item.q, item.o[0], item.o[1], item.o[2], item.o[3], item.a);
            });
            stmt.finalize(err => {
                if (err) {
                    console.error('插入內外科護理學題目失敗:', err.message);
                } else {
                    console.log(`已成功插入 ${quizzesMS.length} 題 '${subjectMS}' 題目`);
                }
            });
        });

        // --- 其他科目的範例題目 (如果不存在才插入) ---
        const otherSubjects = ['產兒科護理學', '精神科與社區衛生護理學'];
        const sampleQuizzes = [
            { subject: otherSubjects[0], q: '新生兒黃疸最常見的原因是？', o: ['生理性黃疸', '病理性黃疸', '餵食不足', '感染'], a: 'A' },
            { subject: otherSubjects[1], q: '社區護理的主要目標是？', o: ['治療疾病', '預防疾病與促進健康', '提供安寧療護', '執行手術'], a: 'B' }
        ];

        otherSubjects.forEach(subject => {
            db.get('SELECT COUNT(*) as count FROM quizzes WHERE subject = ?', [subject], (err, row) => {
                if (!err && row && row.count === 0) {
                    const quiz = sampleQuizzes.find(q => q.subject === subject);
                    if (quiz) {
                        db.run('INSERT INTO quizzes (subject, question, option_a, option_b, option_c, option_d, correct_answer) VALUES (?, ?, ?, ?, ?, ?, ?)',
                            [quiz.subject, quiz.q, quiz.o[0], quiz.o[1], quiz.o[2], quiz.o[3], quiz.a],
                            (err) => {
                                if (!err) console.log(`已插入範例題目: ${quiz.subject}`);
                            }
                        );
                    }
                }
            });
        });

        // --- 產兒科護理學 ---
        const subjectOB = '產兒科護理學';
        const quizzesOB = [
            { q: '有關婦嬰生命統計資料的敘述， 下列何者錯誤？', o: ['粗出生率係指一年內每千位人口的平均活產數', '總生育率係指每年每千位育齡婦女合計生育的子女數', '台灣使用總生育率作為衡量人口生育水準的標準', '開發中的國家， 其粗出生率往往較低'], a: 'D' },
            { q: '護理師為妊娠32週的趙女士進行腹部四段式觸診，  下列敘述何者最適當？', o: ['檢查前請趙女士喝很多水以漲滿膀胱', '第四段觸診時應面向趙女士以評估胎兒背部', '觸診子宮底型態感覺硬、圓、光滑則為胎兒臀部', '觸診腹部兩側感覺較硬及平滑面為胎兒背部'], a: 'D' },
            { q: '陳女士月經週期規律， 偶睡前服用鎮靜劑， 因月經過期10天， 自行購買驗孕棒進行妊娠試驗， 下列敘述何者正確？', o: ['太早進行驗孕， 驗孕棒結果不準確', '驗孕棒原理是以聯酶法（ ELISA） 檢測尿液中hCG濃度', '以睡前中段尿液檢測， 可得較準確的結果', '服用鎮靜劑可能導致假陰性反應'], a: 'B' },
            { q: '懷孕32週婦女， 當有人經過其身旁時， 會不由自主用雙手護住肚子， 下列何者最能形容其孕期的母性任務行為？', o: ['確保與他人的社會互動之距離', '確認自己身體外觀的變化', '關注自己身體功能的運作', '關注自己身體界限的完整'], a: 'D' },
            { q: '懷孕28週婦女， 詢問有關懷孕期自我會陰按摩方法， 下列護理指導何者不適當？', o: ['可於預產期前6週開始執行', '採一腳跨踩於椅子上進行會陰按摩', '將手指塗抹潤滑油， 放入陰道約5公分', '以拇指按壓陰道， 向上按壓， 並往兩側推'], a: 'D' },
            { q: '下列何項血液檢驗值，  可以用來篩檢孕婦是否為海洋性貧血帶因者？', o: ['血色素（ Hb）', '平均紅血球體積（ MCV）', '鐵離子（ Fe++）', 'α -胎兒蛋白（ α -AFP）'], a: 'B' },
            { q: '有關待產婦因過度產痛所引起的不良生理變化，  下列敘述何者錯誤？', o: ['伴隨產痛的過度換氣，  將造成待產婦出現定向感障礙、感覺異常及四肢痙攣', '產痛將增加待產婦自主神經活性， 減少胎盤血液灌流， 增加胎兒呼吸性酸中毒的危險', '產程過程中激烈產痛， 易產生壓力反應， 增加抗利尿激素分泌', '待產過程出現過度換氣， 增加待產婦呼吸性酸中毒的發生'], a: 'D' },
            { q: '有關吸入性麻醉藥（ inhalation   anesthesia）， 下列敘述何者錯誤？', o: ['屬於全身麻醉劑， 其中一氧化二氮（ N2O）， 為無色無味氣體， 俗稱笑氣', '易影響子宮收縮， 造成產程延長及產後大出血， 增加生產過程的危險', '為水溶性麻醉劑， 容易過胎盤進入胎兒體內， 抑制新生兒的神經反射', '需注意麻醉劑量濃度及避免吸入後引起待產婦嘔吐'], a: 'C' },
            { q: '汪女士， 生產過程未行會陰切開。胎盤娩出後， 檢查發現會陰皮膚及陰道黏膜有撕裂， 但未裂至肌肉層。此情況應記錄為會陰部撕裂傷幾度？', o: ['第一度', '第二度', '第三度', '第四度'], a: 'A' },
            { q: '林女士， G1P0， 懷孕41週， 因自然破水及規則陣痛到院檢查， 陰道內診子宮頸已擴張2公分， 宮縮時疼痛分數為2分（ 0-10分量表）  故協助辦理住院待產。林女士此時最可能出現下列何種行為反應？', o: ['興奮話多， 樂意分享產兆發生過程', '顯得疲累且擔心自己的身體失去控制', '大多閉眼休息， 宮縮不適時， 儘量維持身體不動', '身心能量都集中在應付宮縮上， 常以單字回應問題'], a: 'A' },
            { q: '有關生產疼痛理論與緩解措施之敘述， 下列何者正確？', o: ['按撫法（ effleurage） 對強度疼痛的減痛效果明顯', '骶骨重壓法可減輕下背部疼痛', '生產球適合高危險妊娠婦女使用', '按撫法的原理是依據制約理論'], a: 'B' },
            { q: '有關鼓勵孕產家庭與家中新成員－ 新生兒的依附關係的建立， 下列敘述何者錯誤？', o: ['除了兩歲以下的小孩外，  鼓勵所有家人共同參與新生兒照護', '產後婦女的身體與心理調適，  都可能會影響依附關係之建立', '親子同室有助於家人參與育兒照護工作，  也提供新生兒適應日後的生活環境', '鼓勵父親及家人一起參與親子同室，  可以儘早接觸及認識新生兒'], a: 'A' },
            { q: '林女士， G1P1， 剖腹生產後一週， 主訴全身發熱不舒服， 身體檢查沒有明顯身體其他部位疼痛情況。若是此發熱不適與子宮復舊有關，  下列何者為最可能的子宮復舊評估結果？', o: ['腹部觸診時， 約在下腹部， 接近恥骨聯合處觸摸到子宮底', '按摩後子宮硬度及大小有如棒球', '觸診子宮時， 會有壓迫感， 但不會明顯疼痛不適', '子宮底位於肚臍下五橫指， 惡露呈暗咖啡色帶有臭味'], a: 'D' },
            { q: '下列何者最適合採用泌乳期無月經法（ LAM） 作為避孕方法？', o: ['純母乳哺育， 嬰兒3個月大， 產後第一次月經剛剛結束', '純母乳哺育， 嬰兒4個月大， 產後月經尚未恢復', '主要以母乳哺育， 夜裡偶而添加1～ 2次配方奶， 嬰兒3個月大， 產後月經尚未恢復', '混合哺餵， 嬰兒3個月大， 產後月經尚未恢復'], a: 'B' },
            { q: '有關產後惡露評估， 下列敘述何者為正常生理現象？', o: ['產後第2天， 惡露呈鮮紅色且無血塊， 有惡臭味', '產後第3天， 惡露呈深紅色微量血塊， 有血腥味', '產後第5天， 惡露呈淡乳黃色無血塊， 有血腥味', '產後第12天， 惡露呈暗棕色無血塊， 無血腥味'], a: 'B' },
            { q: '有關哺餵母乳的好處， 下列敘述何者正確？', o: ['哺乳可刺激腦下垂體前葉釋放泌乳激素（  prolactin）  促使子宮收縮', '白天餵奶可以抑制濾泡刺激素（ follicle  stimulating  hormone,  FSH） 的分泌而避孕', '哺乳期間母親需要增加熱量及其他營養素的攝取，  因此體重增加比餵配方奶者多', '哺乳的母親在停經前罹患乳癌或卵巢癌的機率較低'], a: 'D' },
            { q: '有關預防尿布疹的措施， 下列何者最適當？', o: ['包裹新的尿布前需使用痱子粉保持皮膚乾爽', '溫水清潔後使用酒精消毒皮膚降低細菌孳生', '大小便後以溫水清洗再用清潔的布拭乾', '改餵配方奶以減少排便次數'], a: 'C' },
            { q: '沐浴前將新生兒置於有磅秤紙的體重計進行體重量測， 沐浴後以乾毛巾迅速擦乾其身體， 此乃運用下列那些預防體熱喪失的機制？', o: ['對流及蒸發', '傳導及蒸發', '傳導及輻射', '對流及輻射'], a: 'B' },
            { q: '採純母乳哺餵之健康新生兒出生體重為3,900公克，  出生第三天體重降為3,700公克，  父母非常擔憂該新生兒體重降低的狀況， 此時最適合的護理指導為何？', o: ['三天內體重減輕200公克可能與新生兒腸胃道吸收功能不佳有關，  需要請醫師檢查', '出生前幾日的體重減輕可能與生理性黃疸有關，  應該要立即抽血檢查', '三天內體重減輕200公克與母乳分泌不足有關，  教導母親應多喝水與多食用高蛋白食物', '此為正常新生兒生理性體重流失現象， 增加哺餵次數體重會慢慢恢復， 不必太過擔憂'], a: 'D' },
            { q: '王女士使用催產素引產， 胎兒監測器呈現宮縮頻率及持續時間為 60" /1\'30" -2\'， 宮縮時壓力100mmHg， 子宮頸口一直停留在4公分， 胎心音為135～ 150 bpm， 下列何者為最優先處置？', o: ['鼓勵待產婦下床走動', '停止催產素注射', '採右側臥姿勢', '準備緊急剖腹產'], a: 'B' },
            { q: '林女士待產時突然主訴腹部呈撕裂性疼痛， 護理師評估腹部有一明顯凹陷， 無法測到宮縮和胎心音， 此情境最可能為？', o: ['低張性子宮收縮', '早期破水', '子宮破裂', '羊水栓塞'], a: 'C' },
            { q: '有關產後血栓性靜脈炎之敘述， 下列何者正確？', o: ['產後血小板及凝血因子數量增加是其主因', '長期服用口服避孕藥婦女較不易發生', '待產期出汗脫水而造成血液濃稠是其主因', '孕期水腫婦女較易發生'], a: 'A' },
            { q: '王女士， 30歲， G1P1， 有妊娠期糖尿病， 有關產後的避孕護理指導， 下列何者較為合適？', o: ['子宮內避孕器', '口服避孕藥', '輸卵管結紮', '保險套'], a: 'D' },
            { q: '在已開發國家中會以那些措施預防愛滋病的母子垂直感染？  ①妊娠期接受完整的抗愛滋病毒藥物治療 ②採剖腹生產 ③新生兒給與預防性口服抗愛滋病毒藥物 ④分娩前母親血中病毒量＜ 400 copies/mL者方可哺餵母乳', o: ['僅①②', '僅③④', '①②③', '①②④'], a: 'C' },
            { q: '吳女士， 25歲， 罹患淋病（ gonorrhea）， 下列產後護理措施何者適當？', o: ['指導其性生活可以繼續， 但頻率要減少', '教導執行自我陰道灌洗技術', '收集子宮頸口分泌物進行細菌培養', '使用2%   tetracycline藥膏預防新生兒眼疾發生'], a: 'C' },
            { q: '兒童急救的生命之鏈（ pediatric  chain  of  survival） 有五個環環相扣的重要程序， 第一步驟為何？', o: ['預防傷害發生', '儘早心肺復甦術', '儘早高級醫療照護', '啟動緊急救護系統'], a: 'A' },
            { q: '有關兒童遭受虐待的護理處置， 下列敘述何者錯誤？', o: ['儘速將受虐者與施虐者隔離， 避免兒童繼續遭受虐待', '受虐者須與父母一起接受問診確認事情發生過程，  不能分開會談', '執行醫療照護時， 需注意受虐兒童隱私問題', '得知父母親缺乏支持系統， 加上經濟壓力， 應儘快提供社會資源'], a: 'B' },
            { q: '護理師提供父母親對自閉症兒童的照護指導，  下列敘述何者不適當？', o: ['可增加居家環境的改變， 刺激其認知學習', '行為症狀會持續至成人期', '使用抗思慮障礙劑或中樞神經活化劑等藥物， 以減輕症狀', '多於幼兒期即被發現， 宜即早安排接受早期療育'], a: 'A' },
            { q: '10個月大新生兒進行身體檢查仍會有的反射項目，  下列何者最為正確？', o: ['驚嚇反射（ startle reflex）', '手掌抓握反射（ palmar  grasp  reflex）', '踏步反射（ stepping  reflex）', '巴賓斯基氏反射（ Babinski\' s  reflex）'], a: 'D' },
            { q: '有關兒童使用眼藥的注意事項， 下列敘述何者正確？', o: ['將眼藥膏塗抹於下眼瞼結膜上', '將眼藥水滴於下眼瞼結膜外側', '給藥時請兒童頭後仰且往下看', '醫囑O.D.是指雙眼給藥'], a: 'A' },
            { q: '小婷， 14歲， 因罹患全身性紅斑性狼瘡（ systemic  lupus  erythematosus,  SLE） 住院進行脈衝治療（ pulse  therapy）， 護理師提供的照護措施， 下列何者不適當？', o: ['住院期間， 鼓勵其與同儕保持聯繫', '告知疾病和治療對身體外觀影響不大， 以減輕其不安', '評估疼痛的程度， 避免因隱瞞而疏忽對其疼痛的處理', '注意傾聽並提供支持， 避免評論'], a: 'B' },
            { q: '下列何者不屬於FLACC行為疼痛評估量表的向度？', o: ['臉部表情', '活動力', '安撫', '呼吸型態'], a: 'D' },
            { q: '罹患第一型糖尿病兒童的照護趨勢， 專業人員運用賦權（ empowerment） 在以家庭為中心照護的目的， 下列何者較適當？', o: ['父母參與孩子的每一項治療與檢查的過程', '父母減少孩子與社區的互動， 避免被污名化', '避免談論慢性疾病的存在， 促使生活正常化', '專業人員提供諮商輔導， 增進父母對治癒有信心'], a: 'A' },
            { q: '吳小妹， 妊娠31週又2天出生， 出生體重1,698公克， 吳太太至新生兒加護中心探視吳小妹， 下列護理處置何者錯誤？', o: ['說明早產兒特性及身上的使用設備', '安排及示範吳太太學習早產兒照護技巧', '鼓勵吳太太執行袋鼠護理', '告知吳太太減少觸摸吳小妹， 以避免過多刺激及感染'], a: 'D' },
            { q: '依據皮亞傑（ Piaget） 的認知發展理論， 有關3〜5歲學齡前期兒童的死亡概念， 下列敘述何者正確？', o: ['不了解死亡， 缺乏死亡概念', '死亡如同睡覺， 會醒過來', '人死無法復活， 唯獨壞人才會死亡', '人死不能復生， 人人都會面臨死亡'], a: 'B' },
            { q: '簡小妹為35週出生的早產兒，  體重2,400公克，  被診斷有高膽紅素血症（  hyperbilirubinemia），今抽血所得總膽紅素值（ total bilirubin） 為26 mg/dL， 有關換血治療的護理， 下列敘述何者正確？', o: ['換血後2小時由靜脈滴注  25%  albumin（ 1  gm/kg）， 預防核黃疸', '協助醫師放置導管插入臍動脈， 或橈動脈、股動脈', '每換200 mL的血液， 需注射10％ 葡萄糖溶液2 mL', '換血後需追蹤總膽紅素值， 觀察期間繼續照光治療'], a: 'D' },
            { q: '小英， 6個月， 出現輕微發燒、食慾不振、喉嚨痛、耳後及後頸部淋巴結腫大等症狀。他先在臉部出現粉紅色斑丘疹， 再漫延至頸部、手臂、軀幹， 而後逐漸往下肢發展， 但疹子出現3天即消除。小英最可能感染下列何種疾病？', o: ['麻疹（ measles）', '德國麻疹（ rubella）', '嬰兒玫瑰疹（ roseola   infantum）', '感染型紅斑（ erythema   infectiosum）'], a: 'B' },
            { q: '使用氧氣頭罩（ O2 hood） 之照護措施， 下列敘述何者最不適當？', o: ['氧氣流速大於5～ 6  L/min， 可防CO2滯留', '潮濕瓶與蛇行管宜每週更換一次', '避免直接吹到病童臉上以減少體熱喪失', '以生理食鹽水作為噴霧來源效果更好'], a: 'D' },
            { q: '有關黴漿菌性肺炎（ mycoplasma pneumonia） 之敘述， 下列何者正確？', o: ['常見的呼吸音為肋膜摩擦音', '主要由肺炎雙球菌引起， 導致黏膜水腫', '咳嗽明顯常伴有痰音， 痰液黏稠、黃綠色且量多', '使用藥物為erythromycin或azithromycin'], a: 'D' },
            { q: '小強， 5歲， 長期服用毛地黃（ digoxin） 之護理指導， 下列敘述何者最適當？', o: ['若服藥前測量一分鐘心跳低於90次則暫停服藥一次', '建議與其他食物混合餵食， 以利藥物吸收', '若使用利尿劑（ Lasix）， 避免香蕉、深綠色蔬菜等含鉀高之食物', '於服藥時間後4小時發現忘記服藥應補服'], a: 'D' },
            { q: '有關海洋性貧血兒童使用排鐵劑（ deferoxamine）  治療，  下列敘述何者錯誤？', o: ['排鐵過程尿液會呈現紅色或橘紅色', '適應的年齡為5～ 7歲， 因遵從性會更好', '排鐵過程需補充維他命C', '可以皮下注射， 宜在晚間執行'], a: 'B' },
            { q: '有關苯酮尿症（ phenylketonuria） 之護理指導， 下列何者錯誤？', o: ['為體染色體隱性遺傳的疾病， 會遺傳給下一代', '禁餵母奶， 須餵食低苯胺基丙酸（ 如： lofenalac） 或不含苯丙胺酸（ 如： phenyl-free） 之配方奶', '飲食須富含蛋白質食物， 避免產生神經系統後遺症', '不治療會有髮色淡黃、霉臭味尿液、智力不足症狀'], a: 'C' },
            { q: '有關初診斷白血病的臨床表徵， 下列敘述何者最適當？', o: ['血壓下降、心律不整', '呼吸困難、臉潮紅', '發燒、疲憊', '腹痛、少尿'], a: 'C' },
            { q: '小雄， 3歲， 罹患威爾姆氏腫瘤（ Wilms   tumor） 第三期， 有關護理照護， 下列敘述何者錯誤？', o: ['提醒父母、家人和相關醫療人員， 應避免觸診小雄的腹部', '主要治療方式包含腎臟切除術、化學治療以及放射線治療', '小雄白血球低於1,000 /mm3， 採取保護性隔離避免感染', '放射線治療主要採全身性治療， 避免腫瘤擴散'], a: 'D' },
            { q: '有關急性腎絲球腎炎（ acute     glomerulonephritis） 病童的照護措施， 下列敘述何者最適當？', o: ['牛奶及香蕉在少尿期， 不需特別限制', '急性期鼓勵多下床活動， 減輕水腫', '血尿素氮（ BUN） 達100 mg/dL ， 須採高蛋白飲食', '維持正常體液， 兒童排尿量須達1～ 2  mL/kg/hr'], a: 'D' },
            { q: '莉莉， 4個月， 此次因唇裂（ cleft lip） 住院， 醫師安排進行唇裂修補術， 在手術後的照護， 下列敘述何者較適當？', o: ['鼓勵採俯臥， 以預防呼吸道阻塞', '向家屬解釋病童手術後出現不斷吞嚥動作是術後正常的現象', '術後疼痛哭鬧， 給與安撫奶嘴使用以降低疼痛', '須給與適時約束手肘， 以避免摩擦臉部影響傷口癒合'], a: 'D' },
            { q: '小敏， 8歲， 因為長期嚴重便秘而入院檢查， 檢查後發現大量大便堆積腸道， 欲執行大量灌腸。有關大量灌腸的護理指導， 下列敘述何者最不適當？', o: ['大量灌腸溶液的溫度， 以30～ 36oC左右較合適', '可以利用遊戲、故事或娃娃模型示範解釋灌腸的目的與步驟', '灌腸中如出現臉色蒼白、冒冷汗、心跳加快應停止，  並通知醫師', '協助病童採左側臥， 右膝屈曲的姿勢'], a: 'A' },
            { q: '芷妹， 9歲， 因頭痛、發燒就醫， 診斷為病毒性腦膜炎（ virus   meningitis） 入院治療， 有關此疾病相關症狀和治療， 下列敘述何者錯誤？', o: ['最主要的治療是儘早給與抗生素', '大部分由腸病毒及腮腺炎病毒引起', '腦脊髓液外觀通常清澈', '少有神經功能障礙後遺症'], a: 'A' },
            { q: '張小弟， 10歲， 診斷為裘馨氏肌失養症（ Duchenne  muscular  dystrophy）， 有關病因和臨床表徵， 下列敘述何者錯誤？', o: ['體染色體隱性遺傳疾病', '蹲下拿東西， 無力獨自站起來', '直立時明顯腰椎前彎', '小腿肚（ 腓腸肌） 假性肥大'], a: 'A' },
            { q: '小美， 15個月大， 從樓梯跌落導致頭部受傷， 急診護理師依據兒童適用之葛氏昏迷量表（ Glasgow coma scale, GCS） 評估其意識程度， 結果顯示叫他時會睜眼， 雖會哭泣但可安撫， 輕觸其手臂會收縮反應， 請問小美的昏迷指數為幾分？', o: ['7分', '9分', '12分', '15分'], a: 'C' }
        ];

        db.run('DELETE FROM quizzes WHERE subject = ?', [subjectOB], function(err) {
            if (err) {
                console.error('刪除舊產兒科護理學題目失敗:', err.message);
                return;
            }
            console.log(`已清除舊的 '${subjectOB}' 題目`);

            const stmt = db.prepare('INSERT INTO quizzes (subject, question, option_a, option_b, option_c, option_d, correct_answer) VALUES (?, ?, ?, ?, ?, ?, ?)');
            quizzesOB.forEach(item => {
                stmt.run(subjectOB, item.q, item.o[0], item.o[1], item.o[2], item.o[3], item.a);
            });
            stmt.finalize(err => {
                if (err) {
                    console.error('插入產兒科護理學題目失敗:', err.message);
                } else {
                    console.log(`已成功插入 ${quizzesOB.length} 題 '${subjectOB}' 題目`);
                }
            });
        });

        // --- 精神科與社區衛生護理學 ---
        const subjectPS = '精神科與社區衛生護理學';
        const quizzesPS = [
            { q: '林小姐常責怪自己， 認為凡事過錯都是自己造成的。下列何項心理防衛機轉最適合說明林小姐的行為？', o: ['合理化（ rationalization）', '潛抑（ repression）', '內射（ introjection）', '退化（ regression）'], a: 'C' },
            { q: '精神醫學史上， 主張不以鐵鍊限制病人行動， 奠定人道主義精神照護的代表性人物， 下列何者正確？', o: ['克雷佩林（ Emil Kraepelin）', '畢乃爾（ Phillipe Pinel）', '佛洛伊德（ Sigmund Freud）', '瓊斯（ Maxwell Jones）'], a: 'B' },
            { q: '根據DSM-5診斷準則， 有關精神疾病的診斷及臨床表徵， 下列敘述何者正確？', o: ['妄想症（ delusional disorder） 病人經常會出現明顯奇特怪異的行為', '重鬱症（ major depressive disorder） 病人最常出現思緒飛躍的症狀', '思 失調症（ schizophrenia） 病人最常出現罪惡妄想的症狀', '強迫症（ obessive-compulsive disorder） 病人會出現強迫思考、強迫行為的症狀'], a: 'D' },
            { q: '有關抗精神病藥物的敘述， 下列何者正確？', o: ['躁症急性發作期， 若已使用情緒穩定劑， 則不建議併用抗精神病藥物', 'clozapine（ Clozaril®） 和fluvoxamine（ Luvox®） 產生交互作用， 會誘發非預期癲癇痙攣', '長效針劑risperidone（ Risperdal Consta®） 本質水性， 多採淺層肌肉注射', '鋰鹽為治療譫妄症的首選藥物'], a: 'B' },
            { q: '護理師詢問病人「您幾歲？」， 病人回答「38歲」， 再繼續問病人「之前的工作服務多久？」， 病人仍回答「38歲」， 病人對之後的問題皆回答「38歲」。此現象屬於下列何種症狀？', o: ['音韻連結（ clang association）', '言語持續（ perseveration）', '重複言語（ verbigeration）', '回音性言語（ echolalia）'], a: 'B' },
            { q: '有關「以整個事件中的單一細節下結論， 而沒有考慮整個事件中還有其他相關的訊息」， 是屬於下列何項「負向認知思考模式」？', o: ['二極化的思考', '完美主義', '選擇性的偏差推論', '武斷推論'], a: 'C' },
            { q: '下列何者不是動機式晤談法（ motivational interview） 的基本原則？', o: ['創造不一致的想法', '應用夢的解析分析問題', '支持自我效能感', '避免發生爭辯'], a: 'B' },
            { q: '有關代幣制度的敘述， 下列何項不適宜？', o: ['是行為治療中的一項技術', '最適合在病人精神症狀混亂時使用', '以具有交換價值的象徵物代替金錢', '屬於操作制約作用的學習原理'], a: 'B' },
            { q: '胡先生， 診斷為思 失調症， 因不停將家中東西丟到大街上， 哥哥予以制止， 胡先生即要攻擊哥哥。剛入住急性病房治療， 下列何者為最優先的護理處置？', o: ['確認胡先生身邊環境與物品的安全性， 進行暴力行為之評估與預防發生', '直接先至保護室並給予預防性約束， 以免發生自傷傷人行為', '警告胡先生在醫院裡面不容許有攻擊行為發生， 否則就無法出院', '為表達護理師的關懷與建立信任， 可先單獨與病人會談了解他為何要攻擊哥哥'], a: 'B' },
            { q: '根據DSM-5診斷準則， 有關情感思 失調症（ schizoaffective disorder） 的敘述， 下列何者正確？', o: ['臨床症狀以情感障礙為主', '在無情緒障礙症發作時， 有二週以上的妄想或幻', '思考障礙和情緒障礙不會同時發作', '不會出現妄想、幻'], a: 'A' },
            { q: '宋小姐因情緒低落且有自殺行為， 入院治療已兩週， 常一個人臥床獨處， 少與其他病友互動。下列何項護理措施最適宜？', o: ['配合病人低落心情， 環境宜減少光線刺激', '提供安靜的單人房， 減少打擾病人', '播放低沉的音樂， 避免刺激病人', '設計簡單的活動， 增加病人活動'], a: 'D' },
            { q: '陳同學19歲， 出現怪異行為， 診斷為思 失調症。因為干擾鄰居被送至精神科急性病房住院。入院時， 說自己沒有生病， 吵著要出院回家。以下何項護理措施最適切？', o: ['請他保證不再干擾鄰居就可以回家', '跟他說必須住滿三個月才可考慮出院', '引導他表達自己會住院的過程', '跟他說只要配合吃藥就可以出院'], a: 'C' },
            { q: '承上題， 住院第二天， 陳同學表示我的父母一定是假的， 否則不會將自己的小孩抓來住院。下列護理師的回答何者最適當？', o: ['你的父母是不得已的', '你的父母是為你好', '父母的想法很難瞭解', '這個想法很困擾你'], a: 'D' },
            { q: '林先生總是表現出自己很優越， 看不起醫護人員， 認為自己是群體中最重要的人， 且擁有特權。護理師針對此自戀行為（ narcissistic） 之應對方式， 下列何者最適切？', o: ['持續的讚美病人， 滿足其自誇的需求', '利用幽默， 與病人開玩笑， 營造輕鬆的氣氛', '為維持病人的自尊， 接受病人對醫護人員的貶低', '了解病人的自誇行為並持續提供包容， 但避免過度讚美'], a: 'D' },
            { q: '有關創傷後壓力症（ posttraumatic stress disorder） 的敘述， 下列何者最適切？', o: ['會出現解離反應， 感到創傷事件重演', '不包含目擊創傷發生於他人身上的經驗', '創傷事件不會產生明顯生理反應', '負面情緒不包含易怒或無預兆的發怒'], a: 'A' },
            { q: '辛小姐診斷為強迫症， 會反覆出現希望妹妹死掉的念頭， 且對此感到非常焦慮。所以每當看到妹妹時， 就開始在心中默念圓周率的數字以減輕焦慮。下列何項敘述最能說明辛小姐的行為？', o: ['以抵消對妹妹的負面想法', '以投射的作用逃避念頭', '自我肯定， 證明自己的數學好', '一種解離性的狀態'], a: 'A' },
            { q: '有關使用嗎啡之敘述， 下列何者正確？', o: ['嗎啡能有效止痛且提神', '嗎啡使用後會產生欣快感', '嗎啡只能口服使用', '護理師可自行斟酌使用'], a: 'B' },
            { q: '根據DSM-5診斷準則， 有關智能不足適應功能的評估， 下列何者最不適切？', o: ['適應功能評估包含概念、社會以及實務三個領域', '個人在獨立與擔當社會責任方面無法達到適齡的發展及文化準則， 稱為適應功能缺損', '評估個人的閱讀、書寫、問題解決能力以及對陌生情境的判斷力等， 是屬實務領域', '適應功能缺損會使個人在多重環境中的一項或多項日常活動功能受限'], a: 'C' },
            { q: '陳小弟， 上課時容易分心、坐不住、喜歡往外跑， 不受控制的行為讓老師很困擾。陳小弟最可能出現以下何項問題？', o: ['智能不足（ intellectural disabilities）', '雙相情緒障礙症（ bipolar disorder）', '妥瑞氏症（ Tourette\'s disorder）', '注意力不足／ 過動症（ ADHD）'], a: 'D' },
            { q: '有關老年憂鬱症的敘述， 下列何者最不適切？', o: ['以身體症狀反應情緒', '常談論自殺想法', '記憶力變差', '合併日落症候群'], a: 'D' },
            { q: '有關社區精神衛生護理評估的敘述， 下列何者正確？', o: ['不需了解個案的生活習慣及社交狀態， 以免涉及病人私領域', '不需評估照顧者對病人疾病的瞭解， 以免涉及照顧者私領域', '不需評估社區的資源， 因與精神衛生護理無關', '需評估個案、家屬及社區三方面的狀況，  以提供多元的社區照護'], a: 'D' },
            { q: '對於安置在精神護理之家的病人，  下列服務內容何者最適宜？', o: ['病人的精神症狀呈現慢性化， 宜提供生活的照顧', '照顧目標應優先讓病人能返回家庭', '病人的精神症狀屬活躍期， 宜嚴格監控行動', '需積極安排病人就業規劃'], a: 'A' },
            { q: '楊太太擔心自己罹患大腸癌， 經多次檢查皆正常， 但她仍深信自己不久人世， 變得無食慾、失眠，有輕生念頭。下列何項為最優先的護理措施？', o: ['教導紓解壓力的方法', '再做詳盡健康檢查， 降低憂鬱', '評估自殺的風險程度', '鼓勵寫遺囑， 降低焦慮'], a: 'C' },
            { q: '有關社區精神衛生護理的角色功能， 下列何者最適切？', o: ['不提供直接照護服務', '個案管理者是唯一的角色功能', '發現心理困擾個案是疾病預防者的角色', '不須進行研究工作'], a: 'C' },
            { q: '有關解除肢體的約束， 下列何者最不適宜？', o: ['避免提及約束之事， 以免激怒病人', '瞭解病人在約束中的感受及需要', '與其他工作人員共同解除病人的約束', '觀察約束部位的膚色狀況'], a: 'A' },
            { q: '根據衛生福利部國民健康署的政策， 有關增進社區民眾健康識能的敘述， 下列何者最不適當？', o: ['推動持續性與整合性的照護及增進社區民眾的健康識能', '提供具實證基礎、非商業目的且攸關社區健康議題的健康資訊', '對於需要複雜照護的病人， 應有清楚且容易執行的出院照護計畫', '社經弱勢等群體暫緩列入提升健康識能的對象'], a: 'D' },
            { q: '有關全民健康保險的敘述， 下列何者最不適當？', o: ['全民納保率已達95％ 以上', '保險費由保險對象、雇主及政府共同分擔', '屬於可自由參加的商業保險', '財務來源包含菸品健康福利捐'], a: 'C' },
            { q: '有關流行病學的敘述， 下列何者最不適當？', o: ['專為探討傳染病的流行概況', '流行病指一個疾病的發生超過正常期望值', '疾病的探討不限於地點或時間', '可探討暴露源和疾病的因果關係'], a: 'A' },
            { q: '提供工廠作業員安全防護器具以減少傷害發生，  是屬於三段五級預防工作的那一級？', o: ['第一級', '第二級', '第三級', '第四級'], a: 'B' },
            { q: '在疫情期間維持適當社交距離， 是針對三角致病模式（ epidemiological  triangle） 中那一因素的處理策略？', o: ['壓力', '環境', '病原體', '宿主'], a: 'B' },
            { q: '某社區為降低老人跌倒率， 增設無障礙設施， 此屬渥太華健康促進憲章行動綱領的那一項？', o: ['建立健康公共政策', '創造支持性環境', '強化社區活動', '發展個人技巧'], a: 'B' },
            { q: '有關社區健康評估之敘述， 下列何者最不適當？', o: ['使照護計畫能真正反應社區的需求', '提升社區健康照護計畫之品質', '隨機抽樣最常用來選擇重要人物進行訪談', '民意團體過程法可以用來形成排定社區健康問題優先順序的共識'], a: 'C' },
            { q: '根據Anderson及McFarlane以社區為夥伴的架構中， 有關人口群體特性評估之內容， 下列何者最不適當？', o: ['男女的性比', '婚姻狀況', '對村／ 里長的滿意度', '社會增加率'], a: 'C' },
            { q: '有關自我效能（  self-efficacy）  之敘述，  下列何者最不適當？', o: ['是指個人評估在特定環境下， 能完成特定行為的能力', '自我效能低者容易因為失敗經驗而導致自我效能再度降低', '外在資源越多者， 自我效能越高', '包括程度、類化和強度等三個層面'], a: 'C' },
            { q: '依據加拿大衛生福利部於1974年提出的影響健康的四大要素，  下列那一項對健康的影響最大？', o: ['提供基因檢測', '控制環境中PM2.5濃度', '廣推在宅醫療', '鼓勵民眾實踐健康生活'], a: 'D' },
            { q: '王先生參加口腔癌篩檢， 表示嘴破未癒合長達一個月， 且最近有位同事因口腔癌治療飽受身心之苦， 很害怕自己也得了口腔癌， 妻子鼓勵他參與篩檢。依據健康信念模式， 下列何者是影響王先生採取預防行為的因素？ ①罹患性認知 ②嚴重性認知 ③行動線索 ④利益性認知 ⑤自我效能', o: ['①②③', '①②⑤', '②③④', '③④⑤'], a: 'A' },
            { q: '有關水媒疾病之敘述， 下列何者最不適當？', o: ['志賀氏桿菌是細菌性痢疾的致病原之一', '阿米巴原蟲是副傷寒的致病原之一', '小兒麻痺病毒是小兒麻痺症的致病原', '鞭毛蟲是寄生蟲病的致病原之一'], a: 'B' },
            { q: '臺灣淨水廠的供水系統目前廣泛使用何種消毒法？', o: ['氯氣消毒法', '臭氧消毒法', '紫外線照射消毒法', '銀離子消毒法'], a: 'A' },
            { q: '有關紫外線防護之護理指導， 下列何者最不適當？', o: ['高山、雪地更易受紫外線傷害', '紫外線傷害可能會造成白內障', '紫外線指數6以上代表紫外線指數過高', '太陽眼鏡鏡片顏色越深， 防紫外線效果越佳'], a: 'D' },
            { q: '護理師進行家訪時發現， 李奶奶因患有退化性骨關節炎而行動不便， 李爺爺則患有高血壓和糖尿病，  已定期回診並規律服藥控制。下列何者為此家庭最優先的個案管理目標？', o: ['鼓勵李奶奶進行關節置換術， 提高自主生活能力', '監測並管理李爺爺的服藥遵從性', '提供居家安全評估， 減少跌倒和其他意外事件的發生', '安排社交活動， 促進心理健康和社交互動'], a: 'C' },
            { q: '下列何者不屬於衛生福利部107年度原鄉健康不平等之改善策略行動計畫？', o: ['骨骼肌肉傷害', '結核病', '消化系癌症', '三高防治'], a: 'A' },
            { q: '42歲王太太的姐姐被診斷乳癌， 為此王太太感到煩惱和擔憂。下列護理指導何者最適當？ ①乳癌的危險因子， 包括初經較晚、停經較早、高脂肪飲食等 ② 40歲以上至未滿45歲具有乳癌家族史的女性每年一次免費乳房X光攝影檢查 ③建議王太太多運動、少進食高脂肪食物、心情放鬆和減低壓力等', o: ['僅③', '①②③', '僅①③', '僅②③'], a: 'A' },
            { q: '下列那些是骨質疏鬆的危險因子？ ①體重過重 ②飲食含鹽量過少 ③缺乏運動 ④飲酒過量 ⑤甲狀腺機能亢進', o: ['①④⑤', '②③④', '②③⑤', '③④⑤'], a: 'D' },
            { q: '有關校園霸凌之敘述， 下列何者最適當？ ①個人或集體持續以語言、肢體動作或網路等直接對他人故意欺負或戲弄之行為 ②成績優秀者最不容易成為被霸凌的對象 ③長期遭受霸凌者可能出現反擊行為再去霸凌比自己弱勢的人 ④網路霸凌須有重複性， 至少要有二次才算', o: ['①②③', '僅①③', '①③④', '僅③④'], a: 'B' },
            { q: '健康促進醫院為提升醫護人員的身體活動量而推動院內運動計畫， 護理人員反應：「下班太累， 無法參加」， 此反應為潘德（ Pender） 健康促進模式中的何項行為認知？', o: ['自 自我效能', '個人因素', '自 行動障礙', '情境的影響'], a: 'C' },
            { q: '根據全民健康保險規定， 可接受安寧緩和醫療照護之末期病人的主要支付診斷條件， 下列何者最不適當？', o: ['老年期及初老期器質性精神病態', '慢性肝病及肝硬化', '急性腎衰竭， 未明示者', '思 失調症'], a: 'D' },
            { q: '85歲方奶奶獨居， 巴氏量表評估為65分， 目前無法自行洗澡和備餐， 需有社區志工陪同就醫。若要申請長期照顧服務項目， 何項最合適？', o: ['居家護理', '居家服務', '家庭托顧', '居家喘息'], a: 'B' },
            { q: '林女士76歲獨居， 有多重慢性病史， 不慎跌倒導致下肢嚴重骨折， 經住院治療後病情穩定出院回家休養。有關個案管理師的職責， 下列何者最不適當？', o: ['與林女士共同訂定計畫， 使其能恢復獨立自主的生活', '聯繫藥師提供藥物整合服務， 指導林女士正確用藥', '親自到府執行復健， 並提供日常生活功能服務', '定期電話訪視， 替林女士安排就醫回診的交通接送'], a: 'C' },
            { q: '林先生56歲， 身高167公分， 體重82公斤， 喜歡吃滷五花肉， 經常便秘， 初次檢查結果顯示血中總膽固醇（ total cholesterol） 數值為245 mg/dL， 三酸甘油酯（ triglyceride） 的數值為230 mg/dL。護理師提供的衛教重點下列那一項最適當？', o: ['建議優先服用藥物控制膽固醇及三酸甘油酯', '衛教烹飪以快炒或油煎方式取代滷五花肉', '衛教選擇高纖維飲食並減少高油脂的食物攝取', '身體質量指數為體重過重， 建議一天至少運動30分鐘'], a: 'C' },
            { q: '有關氣喘之護理指導， 下列何項最不適當？', o: ['以百葉⑤替代布⑤簾', '避免情緒起伏太大', '進行高強度運動， 以增加肺活量', '遵從醫囑按時用藥， 不可自行停藥'], a: 'C' }
        ];

        db.run('DELETE FROM quizzes WHERE subject = ?', [subjectPS], function(err) {
            if (err) {
                console.error('刪除舊精神科與社區衛生護理學題目失敗:', err.message);
                return;
            }
            console.log(`已清除舊的 '${subjectPS}' 題目`);

            const stmt = db.prepare('INSERT INTO quizzes (subject, question, option_a, option_b, option_c, option_d, correct_answer) VALUES (?, ?, ?, ?, ?, ?, ?)');
            quizzesPS.forEach(item => {
                stmt.run(subjectPS, item.q, item.o[0], item.o[1], item.o[2], item.o[3], item.a);
            });
            stmt.finalize(err => {
                if (err) {
                    console.error('插入精神科與社區衛生護理學題目失敗:', err.message);
                } else {
                    console.log(`已成功插入 ${quizzesPS.length} 題 '${subjectPS}' 題目`);
                }
            });
        });
    });
}

// 系統參數 API
// 獲取所有系統參數
app.get('/api/params', (req, res) => {
    db.all('SELECT * FROM sys_parainfo', [], (err, rows) => {
        if (err) {
            return res.status(500).json({ message: err.message });
        }
        res.json(rows);
    });
});
// 新增、更新、刪除系統參數 API 也都不需驗證
app.post('/api/params', (req, res) => {
    const { param_code, param_value, param_desc, sys_flag } = req.body;
    db.run('INSERT INTO sys_parainfo (param_code, param_value, param_desc, sys_flag) VALUES (?, ?, ?, ?)',
        [param_code, param_value, param_desc, sys_flag || 'N'],
        function(err) {
            if (err) {
                return res.status(500).json({ message: err.message });
            }
            res.status(201).json({ id: this.lastID, message: '參數新增成功' });
        });
});
app.put('/api/params/:id', (req, res) => {
    const { param_code, param_value, param_desc, sys_flag } = req.body;
    db.run('UPDATE sys_parainfo SET param_code = ?, param_value = ?, param_desc = ?, sys_flag = ? WHERE id = ?',
        [param_code, param_value, param_desc, sys_flag, req.params.id],
        function(err) {
            if (err) {
                return res.status(500).json({ message: err.message });
            }
            res.json({ message: '參數更新成功' });
        });
});
app.delete('/api/params/:id', (req, res) => {
    db.run('DELETE FROM sys_parainfo WHERE id = ?', req.params.id, function(err) {
        if (err) {
            return res.status(500).json({ message: err.message });
        }
        res.json({ message: '參數刪除成功' });
    });
});

// 系統功能 API
app.get('/api/menus', (req, res) => {
    db.all('SELECT * FROM sys_menuinfo ORDER BY dispseq', [], (err, rows) => {
        if (err) {
            return res.status(500).json({ message: err.message });
        }
        res.json(rows);
    });
});
app.post('/api/menus', (req, res) => {
    const { paretid, menuna, menuimg, menuurl, menonly, opennew, dispseq } = req.body;
    const lasttm = new Date().toISOString().replace(/[-T:]/g, '').slice(0, 14);
    db.run(`INSERT INTO sys_menuinfo (paretid, menuna, menuimg, menuurl, menonly, opennew, dispseq, lasttm) VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
        [paretid || 0, menuna, menuimg || '', menuurl || '', menonly || 'Y', opennew || 'N', dispseq || '00100', lasttm],
        function(err) {
            if (err) {
                return res.status(500).json({ message: err.message });
            }
            res.status(201).json({ menuid: this.lastID, message: '功能新增成功' });
        });
});
app.put('/api/menus/:id', (req, res) => {
    const { paretid, menuna, menuimg, menuurl, menonly, opennew, dispseq, lastusr } = req.body;
    const lasttm = new Date().toISOString().replace(/[-T:]/g, '').slice(0, 14);
    db.run(`UPDATE sys_menuinfo SET paretid = ?, menuna = ?, menuimg = ?, menuurl = ?, menonly = ?, opennew = ?, dispseq = ?, lastusr = ?, lasttm = ? WHERE menuid = ?`,
        [paretid, menuna, menuimg, menuurl, menonly, opennew, dispseq, lastusr, lasttm, req.params.id],
        function(err) {
            if (err) {
                return res.status(500).json({ message: err.message });
            }
            res.json({ message: '功能更新成功' });
        });
});
app.delete('/api/menus/:id', (req, res) => {
    db.run('DELETE FROM sys_menuinfo WHERE menuid = ?', req.params.id, function(err) {
        if (err) {
            return res.status(500).json({ message: err.message });
        }
        res.json({ message: '功能刪除成功' });
    });
});

// 獲取所有測驗項目
app.get('/api/subjects', (req, res) => {
    db.all('SELECT DISTINCT subject FROM quizzes', [], (err, rows) => {
        if (err) {
            return res.status(500).json({ message: err.message });
        }
        res.json(rows.map(row => row.subject));
    });
});

// 測驗 API
app.get('/api/quizzes', (req, res) => {
    const { subject } = req.query;
    let query = 'SELECT id, question, option_a, option_b, option_c, option_d FROM quizzes';
    const params = [];

    if (subject) {
        query += ' WHERE subject = ?';
        params.push(subject);
    }

    db.all(query, params, (err, rows) => {
        if (err) {
            return res.status(500).json({ message: err.message });
        }
        res.json(rows);
    });
});
app.post('/api/quiz/check-answer', (req, res) => {
    const { questionId, answer } = req.body;
    if (!questionId || !answer) {
        return res.status(400).json({ message: '缺少題目 ID 或答案' });
    }
    db.get('SELECT correct_answer FROM quizzes WHERE id = ?', [questionId], (err, row) => {
        if (err) {
            return res.status(500).json({ message: '資料庫查詢錯誤', error: err.message });
        }
        if (!row) {
            return res.status(404).json({ message: '找不到該題目' });
        }
        const isCorrect = row.correct_answer === answer;
        res.json({
            isCorrect: isCorrect,
            correctAnswer: row.correct_answer
        });
    });
});

// 其他靜態頁面路由保留
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'index.html'));
});
app.get('/dashboard', (req, res) => {
    res.sendFile(path.join(__dirname, 'dashboard.html'));
});
app.get('/quiz', (req, res) => {
    res.sendFile(path.join(__dirname, 'quiz.html'));
});

// 啟動伺服器，監聽所有網路介面
app.listen(port, '0.0.0.0', () => {
    console.log(`伺服器運行在 http://localhost:${port}`);
    console.log('您也可以通過以下方式訪問：');
    console.log(`http://[您的IP位址]:${port}`);
}); 